<!DOCTYPE html>
<html lang="en"><head>
<script src="L14-knn-trees-2_files/libs/clipboard/clipboard.min.js"></script>
<script src="L14-knn-trees-2_files/libs/quarto-html/tabby.min.js"></script>
<script src="L14-knn-trees-2_files/libs/quarto-html/popper.min.js"></script>
<script src="L14-knn-trees-2_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="L14-knn-trees-2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="L14-knn-trees-2_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="L14-knn-trees-2_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="L14-knn-trees-2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.555">

  <title>More KNN and Trees</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="L14-knn-trees-2_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="L14-knn-trees-2_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="L14-knn-trees-2_files/libs/revealjs/dist/theme/quarto.css">
  <link href="L14-knn-trees-2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="L14-knn-trees-2_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">More KNN and Trees</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="settling-in" class="title-slide slide level1 unnumbered center">
<h1>Settling In</h1>
<ul>
<li>Sit with the same group as last class.
<ul>
<li>If you missed class last week, please check in with me to get your (potentially) new group number!</li>
</ul></li>
<li>Locate and open today’s QMD</li>
<li>Catch up on announcements and messages on Slack</li>
<li>Check your Feedback Spreadsheet for recent updates</li>
</ul>
<p><br></p>
</section>

<section id="learning-goals" class="title-slide slide level1 unnumbered smaller center">
<h1>Learning Goals</h1>
<ul>
<li>Clearly describe the recursive binary splitting algorithm for tree building for both regression and classification</li>
<li>Compute the weighted average Gini index to measure the quality of a classification tree split</li>
<li>Compute the sum of squared residuals to measure the quality of a regression tree split</li>
<li>Explain how recursive binary splitting is a greedy algorithm</li>
<li>Explain how different tree parameters relate to the bias-variance tradeoff</li>
</ul>
<p><br></p>
<!-- NOTE to self: Even if a predictor doesn't *appear* in our tree, it can be used as a "surrogate" or replacement predictor if a new image is missing data on a predictor that *does* appear in our tree. Thus all predictors have an importance metric. As such, if a new data point is missing data on a predictor used in the tree, we can still classify it -->
<!-- maybe use this in the future for calculating cv metrics for each land type -->
<!-- https://juliasilge.com/blog/water-sources/ -->
<!-- MY CODE -->
</section>

<section>
<section id="notes-nonparametric-classification" class="title-slide slide level1 unnumbered center">
<h1>Notes: Nonparametric Classification</h1>

</section>
<section id="where-are-we" class="slide level2 unnumbered smaller">
<h2>Where Are We?</h2>
<p><img data-src="images/MLdiagram3.jpg" style="width:90.0%"></p>
<p><strong>CONTEXT</strong></p>
<ul>
<li><p><strong>world = supervised learning</strong><br>
We want to model some output variable <span class="math inline">\(y\)</span> using a set of potential predictors (<span class="math inline">\(x_1, x_2, ..., x_p\)</span>).</p></li>
<li><p><strong>task = CLASSIFICATION</strong><br>
<span class="math inline">\(y\)</span> is categorical</p></li>
<li><p><strong>algorithm = NONparametric</strong></p></li>
</ul>
<p><strong>GOAL</strong></p>
<p>Build and evaluate <strong>nonparametric</strong> classification models of some <strong>categorical</strong> outcome y.</p>
</section>
<section id="quick-recap" class="slide level2 unnumbered smaller">
<h2>Quick Recap</h2>
<p>How do we evaluate classification models?</p>
<div class="fragment">
<p>Binary Metrics:</p>
<ul>
<li>Accuracy (overall; compare to no information rate = frequency of largest class)</li>
<li>Sensitivity (accuracy among Y = 1, true positive rate, recall)</li>
<li>Specificity (accuracy among Y = 0, true negative rate)</li>
<li>False Positive Rate = 1 - Specificity</li>
<li>ROC AUC (accounts for many thresholds)
<ul>
<li>the probability that a randomly chosen case from the Y=1 class will receive, from the classifier, a higher predicted probability than a randomly chosen case from the Y = 0 class</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p>More Binary Metrics [optional]:</p>
<ul>
<li>False Negative Rate = 1 - Sensitivity</li>
<li>J Index = Sensitivity + Specificity - 1</li>
<li>Balanced Accuracy = (Sens + Spec)/2</li>
<li>Kappa (how much better your model is over using class frequencies)</li>
<li>MCC (correlation between truth and prediction)</li>
<li>Positive Predictive Value (accuracy among those we predicted Y = 1, precision)</li>
<li>Precision-Recall AUC (accounts for many thresholds)</li>
<li>F measure = <span class="math inline">\((1 + \beta^2) * precision*recall/((\beta^2*precision) +recall)\)</span> (chosen beta gives one or the other more weight)</li>
</ul>
</div>
<div class="fragment">
<p>Multiclass Metrics:</p>
<ul>
<li>Accuracy</li>
<li>Many binary metrics can be generalized to multiclass situations (optionally see <a href="https://yardstick.tidymodels.org/articles/multiclass.html" class="uri">https://yardstick.tidymodels.org/articles/multiclass.html</a>, <a href="https://www.evidentlyai.com/classification-metrics/multi-class-metrics" class="uri">https://www.evidentlyai.com/classification-metrics/multi-class-metrics</a>)</li>
</ul>
</div>
</section>
<section id="motivating-example" class="slide level2 unnumbered smaller">
<h2>Motivating Example</h2>
<p>We’ll continue to classify land type using metrics from aerial photographs:</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://ncap.org.uk/sites/default/files/EK_land_use_0.jpg"></p>
<figcaption>Image Source: https://ncap.org.uk/sites/default/files/EK_land_use_0.jpg</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="co"># Load &amp; process data</span></span>
<span id="cb1-2"><a href=""></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Our y variable has to be converted to a "factor" variable, not a character string</span></span>
<span id="cb1-3"><a href=""></a>land <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://kegrinde.github.io/stat253_coursenotes/data/land_cover.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href=""></a>  <span class="fu">rename</span>(<span class="at">type =</span> class) <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">as.factor</span>(type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="co"># There are 9 land types! </span></span>
<span id="cb2-2"><a href=""></a><span class="co"># Let's consider all of them (not just asphalt, grass, trees)</span></span>
<span id="cb2-3"><a href=""></a>land <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href=""></a>  <span class="fu">count</span>(type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       type   n
1  asphalt   59
2 building  122
3      car   36
4 concrete  116
5    grass  112
6     pool   29
7   shadow   61
8     soil   34
9     tree  106</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="co"># There are 675 data points and 147 potential predictors of land type!</span></span>
<span id="cb4-2"><a href=""></a><span class="fu">dim</span>(land)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 675 148</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a><span class="co"># For now: we'll consider Mean_G &amp; NDVI</span></span>
<span id="cb6-2"><a href=""></a><span class="co"># (It's not easy to visually distinguish between 9 colors!)</span></span>
<span id="cb6-3"><a href=""></a></span>
<span id="cb6-4"><a href=""></a><span class="co"># Plot type vs Mean_G alone</span></span>
<span id="cb6-5"><a href=""></a><span class="fu">ggplot</span>(land, <span class="fu">aes</span>(<span class="at">x =</span> Mean_G, <span class="at">fill =</span> type)) <span class="sc">+</span> </span>
<span id="cb6-6"><a href=""></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb6-7"><a href=""></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"darkgray"</span>, <span class="st">"red"</span>, <span class="st">"#7570B3"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>, <span class="st">"#E6AB02"</span>, <span class="st">"brown"</span>, <span class="st">"#66A61E"</span>)) <span class="sc">+</span> </span>
<span id="cb6-8"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="co"># Plot type vs NDVI alone</span></span>
<span id="cb7-2"><a href=""></a><span class="fu">ggplot</span>(land, <span class="fu">aes</span>(<span class="at">x =</span> NDVI, <span class="at">fill =</span> type)) <span class="sc">+</span> </span>
<span id="cb7-3"><a href=""></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-4"><a href=""></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"darkgray"</span>, <span class="st">"red"</span>, <span class="st">"#7570B3"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>, <span class="st">"#E6AB02"</span>, <span class="st">"brown"</span>, <span class="st">"#66A61E"</span>)) <span class="sc">+</span> </span>
<span id="cb7-5"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a><span class="co"># Finally consider both</span></span>
<span id="cb8-2"><a href=""></a><span class="fu">ggplot</span>(land, <span class="fu">aes</span>(<span class="at">y =</span> Mean_G, <span class="at">x =</span> NDVI, <span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb8-3"><a href=""></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-4"><a href=""></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"darkgray"</span>, <span class="st">"red"</span>, <span class="st">"#7570B3"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>, <span class="st">"#E6AB02"</span>, <span class="st">"brown"</span>, <span class="st">"#66A61E"</span>)) <span class="sc">+</span> </span>
<span id="cb8-5"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br><br></p>
</section></section>
<section>
<section id="small-group-discussion" class="title-slide slide level1 unnumbered center">
<h1>Small Group Discussion</h1>
<p>Discuss the following examples with your group.</p>
</section>
<section id="example-1-knn" class="slide level2 unnumbered smaller">
<h2>Example 1: KNN</h2>
<p>Check out the classification regions for two KNN models of land <code>type</code> by <code>Mean_G</code> and <code>NDVI</code>: using K = 1 neighbor and using K = 16 neighbors.</p>
<p>Though the KNN models were <em>built</em> using standardized predictors, the predictors are plotted on their original scales here.</p>
<center>
<img src="images/knn_land.png">
</center>
<!-- ![](https://ajohns24.github.io/images/stat253/knn_land.png) -->
<p>Discuss:</p>
<ul>
<li>What do KNN regression and classification have in common?</li>
<li>How are they different?</li>
<li>What questions do you have about…the impact of K, the algorithm, or anything else KNN related?</li>
</ul>
<details>
<summary>
Solution:
</summary>
<ul>
<li>KNN regression &amp; classification both predict y using data on the K nearest neighbors.</li>
<li>In regression, y is predicted by averaging the y values of the neighbors. In classification, y is predicted by the most common y category of the neighbors.</li>
</ul>
</details>
</section>
<section id="example-2-pruned-tree" class="slide level2 unnumbered smaller">
<h2>Example 2: Pruned tree</h2>
<p>Next, consider a <strong>PRUNED classification tree</strong> of land <code>type</code> by <code>Mean_G</code> and <code>NDVI</code> that was pruned as follows:</p>
<ul>
<li>set maximum depth to 30</li>
<li>set minimum number of data points per node to 2</li>
<li>tune the <strong>cost complexity parameter</strong>.</li>
</ul>
<center>
<img src="images/trees_land_1.png">
</center>
<!-- ![](https://ajohns24.github.io/images/stat253/trees_land_1.png) -->
<center>
<img src="images/trees_land_2.png">
</center>
<!-- ![](https://ajohns24.github.io/images/stat253/trees_land_2.png) -->
<p>Discuss:</p>
<ul>
<li>What’s missing from the leaf nodes?</li>
<li>Why did this happen?</li>
<li>What questions do you have about…the algorithm, pruning, or anything else tree related?</li>
</ul>
<details>
<summary>
Solution:
</summary>
<ul>
<li>This tree will never classify an image as a car.</li>
<li>This is because cars are similar to other groups with respect to NDVI and Mean_G (see the plot), and since we don’t have many car data points, other categories are prioritized in the splits.</li>
</ul>
</details>
</section>
<section id="example-3-unpruned-tree" class="slide level2 unnumbered smaller">
<h2>Example 3: Unpruned tree</h2>
<p>Finally, consider a (mostly) <strong>UNPRUNED classification tree</strong> of land <code>type</code> by <code>Mean_G</code> and <code>NDVI</code> that was built using the following tuning parameters:</p>
<ul>
<li>set maximum depth to 30</li>
<li>set minimum number of data points per node to 2</li>
<li>set cost complexity parameter to 0.</li>
</ul>
<p>Check out the classification regions defined by this tree:</p>
<center>
<img src="images/trees_land_4.png">
</center>
<!-- ![](https://ajohns24.github.io/images/stat253/trees_land_4.png) -->
<p>And the tree itself.</p>
<p>This tree was plotted using a function that draws the length of each branch split to be proportional to its improvement to the classification accuracy. The labels are left off to just focus on structure:</p>
<center>
<img src="images/trees_land_3.png">
</center>
<!-- ![](https://ajohns24.github.io/images/stat253/trees_land_3.png) -->
<p>Discuss:</p>
<ul>
<li>What happens to the length of the split branches the further down the tree we get? What does this mean?</li>
<li>What are your thoughts about this tree?</li>
<li>What questions do you have about the impact of the tuning parameters, or anything else tree related?</li>
</ul>
<details>
<summary>
Solution:
</summary>
<ul>
<li>The length of split branches gets smaller as these splits don’t increase accuracy that much</li>
<li>It might be overfit to a dataset</li>
</ul>
</details>
</section></section>
<section>
<section id="new-concepts" class="title-slide slide level1 unnumbered center">
<h1>New Concepts</h1>

</section>
<section id="gini-index" class="slide level2 unnumbered smaller">
<h2>Gini Index</h2>
<p><strong>Gini Index</strong>: Node Purity Measure</p>
<p><span class="math display">\[G = p_1(1-p_1) + p_2(1-p_2) + \cdots + p_k(1-p_k)\]</span></p>
<ul>
<li>“probability of misclassifying a randomly selected case”</li>
<li>Smaller signals “better” classifier</li>
<li>Used to decide whether or not to split based on the cost-complexity parameter (default in rpart)</li>
</ul>
</section>
<section id="information-index" class="slide level2 unnumbered smaller">
<h2>Information Index</h2>
<p><strong>Information/Entropy Index</strong>: Alternative to Gini</p>
<p><span class="math display">\[I = -(p_1\log(p_1) + p_2\log(p_2) + \cdots + p_k\log(p_k))\]</span></p>
<ul>
<li>“measure of amount of uncertainty in the data”</li>
<li>Smaller signals “better” classifier</li>
<li>Used to decide whether or to split based on the cost-complexity parameter (option in rpart)</li>
</ul>
</section></section>
<section>
<section id="exercises" class="title-slide slide level1 unnumbered center">
<h1>Exercises</h1>

</section>
<section id="part-1" class="slide level2 unnumbered smaller scrollable">
<h2>Part 1</h2>
<p>Let’s focus on trees.</p>
<p>We’ve explored some general ML themes already:</p>
<ul>
<li><p>model building: parametric vs nonparametric<br>
benefits and drawbacks of using nonparametric trees vs parametric algorithm logistic regression</p></li>
<li><p>algorithm details:</p>
<ul>
<li>steps of the tree algorithm</li>
<li><strong>tuning</strong> a tree algorithm</li>
</ul></li>
</ul>
<p>In the exercises, you’ll explore some other important themes:</p>
<ul>
<li><p>model building: variable selection<br>
We have <em>147</em> potential predictors of land type. How can we choose which ones to use?</p></li>
<li><p>model evaluation &amp; comparison<br>
How good are our trees? Which one should we pick?</p></li>
<li><p>regression vs classification<br>
KNN works in both settings. So do trees!</p></li>
</ul>
<h3 class="unnumbered" id="exercise-1-build-10-trees">Exercise 1: Build 10 trees</h3>
<p>In modeling land <code>type</code> by <strong>all 147</strong> possible predictors, our goal will be to build a tree that optimize the <code>cost_complexity</code> parameter. The chunk below builds 10 trees, each using a different <code>cost_complexity</code> value while fixing our other tuning parameters to be very liberal / not restrictive:</p>
<ul>
<li><code>tree_depth</code> = 30 (the default)</li>
<li><code>min_n</code> in each leaf node = 2 (the default is 20)</li>
</ul>
<p>Reflect on the code and pause to answer any questions (Q).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a><span class="co"># STEP 1: tree specification</span></span>
<span id="cb9-2"><a href=""></a><span class="co"># Q: WHAT IS NEW HERE?!</span></span>
<span id="cb9-3"><a href=""></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href=""></a>  <span class="fu">set_args</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),  </span>
<span id="cb9-7"><a href=""></a>           <span class="at">min_n =</span> <span class="dv">2</span>, </span>
<span id="cb9-8"><a href=""></a>           <span class="at">tree_depth =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="co"># STEP 2: variable recipe</span></span>
<span id="cb10-2"><a href=""></a><span class="co"># NOTHING IS NEW HERE &amp; THERE ARE NO PREPROCESSING STEPS!</span></span>
<span id="cb10-3"><a href=""></a>variable_recipe_big <span class="ot">&lt;-</span> <span class="fu">recipe</span>(type <span class="sc">~</span> ., <span class="at">data =</span> land)</span>
<span id="cb10-4"><a href=""></a>    </span>
<span id="cb10-5"><a href=""></a><span class="co"># STEP 3: tree workflow</span></span>
<span id="cb10-6"><a href=""></a><span class="co"># NOTHING IS NEW HERE!</span></span>
<span id="cb10-7"><a href=""></a>tree_workflow_big <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href=""></a>  <span class="fu">add_recipe</span>(variable_recipe_big) <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href=""></a>  <span class="fu">add_model</span>(tree_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a><span class="co"># STEP 4: Estimate 10 trees using a range of possible cost complexity values</span></span>
<span id="cb11-2"><a href=""></a><span class="co"># cost_complexity is on the log10 scale (10^(-5) to 10^(0.1))</span></span>
<span id="cb11-3"><a href=""></a><span class="co"># Q: BY WHAT CV METRIC ARE WE COMPARING THE TREES?</span></span>
<span id="cb11-4"><a href=""></a><span class="co"># Q: WHY NOT USE CV MAE?</span></span>
<span id="cb11-5"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">253</span>)</span>
<span id="cb11-6"><a href=""></a>tree_models_big <span class="ot">&lt;-</span> tree_workflow_big <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href=""></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb11-8"><a href=""></a>    <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="fl">0.1</span>)), <span class="at">levels =</span> <span class="dv">10</span>),</span>
<span id="cb11-9"><a href=""></a>    <span class="at">resamples =</span> <span class="fu">vfold_cv</span>(land, <span class="at">v =</span> <span class="dv">10</span>),</span>
<span id="cb11-10"><a href=""></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy)</span>
<span id="cb11-11"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-2-whew">Exercise 2: Whew!</h3>
<p>We only built 10 trees above, and it took quite a bit of time. Why are trees computationally expensive?</p>
<details>
<summary>
Solution:
</summary>
Consider just 1 tree. At every single split, we must evaluate and compare <em>every</em> possible split value of <em>each</em> of the <strong>147</strong> predictors. Building 10 trees and evaluating each using 10-fold CV means that we had to do this 100 times!
</details>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-3-compare-and-finalize-the-tree">Exercise 3: Compare and finalize the tree</h3>
<p>Just as with our other algorithms with tuning parameters, we can use the CV metrics to compare the 10 trees, and pick which one we prefer.</p>
<p>Here, we’ll pick the <em>parsimonious tree</em> (which also happens to be the tree with the largest CV accuracy!).</p>
<p>Run &amp; reflect upon the code below, then answer some follow-up questions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="co"># Compare the CV metrics for the 10 trees</span></span>
<span id="cb12-2"><a href=""></a>tree_models_big <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href=""></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb12-4"><a href=""></a>  <span class="fu">scale_x_continuous</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a><span class="co"># Pick the parsimonious parameter</span></span>
<span id="cb13-2"><a href=""></a>parsimonious_param_big <span class="ot">&lt;-</span> tree_models_big <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href=""></a>  <span class="fu">select_by_one_std_err</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>, <span class="fu">desc</span>(cost_complexity))</span>
<span id="cb13-4"><a href=""></a>parsimonious_param_big</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  cost_complexity .config              
            &lt;dbl&gt; &lt;chr&gt;                
1         0.00681 Preprocessor1_Model06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a><span class="co"># Finalize the tree with parsimonious cost complexity</span></span>
<span id="cb15-2"><a href=""></a>big_tree <span class="ot">&lt;-</span> tree_workflow_big <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href=""></a>  <span class="fu">finalize_workflow</span>(<span class="at">parameters =</span> parsimonious_param_big) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href=""></a>  <span class="fu">fit</span>(<span class="at">data =</span> land)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>What is happening as the cost-complexity parameter <span class="math inline">\(\alpha\)</span> increases:
<ul>
<li>the tree is getting more <em>complicated</em> and the accuracy is <em>improving</em></li>
<li>the tree is getting more <em>complicated</em> and the accuracy is getting <em>worse</em></li>
<li>the tree is getting <em>simpler</em> and the accuracy is <em>improving</em></li>
<li>the tree is getting <em>simpler</em> and the accuracy is getting <em>worse</em></li>
</ul></li>
<li>What will our tree look like if we use a cost complexity parameter bigger than 0.4? As what category will this tree predict all images to be?</li>
<li>CHALLENGE: For cost complexity parameters bigger than 0.4, the accuracy plateaus at roughly 18.1%. Where does this number come from?! NOTE: If you get stumped here, move on. We’ll come back to this later.</li>
<li>You don’t have to write anything out (this is largely review), but convince yourself that you could:
<ul>
<li>interpret the plot</li>
<li>i.d. where our parsimonious tree falls on this plot</li>
<li>explain what “parsimonious” means</li>
</ul></li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>the tree is getting <em>simpler</em> and the accuracy is getting <em>worse</em></li>
<li>a single root node with no splits, which classifies everything as building</li>
<li>this is the no information rate (which we’ll calculate below)</li>
</ol>
</details>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-4-examine-the-tree">Exercise 4: Examine the tree</h3>
<p>Let’s examine the final, tuned <code>big_tree</code> which models land <code>type</code> by all 147 predictors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="co"># This tree has a bunch of info</span></span>
<span id="cb16-2"><a href=""></a><span class="co"># BUT: (1) it's tough to read; and (2) all branch lengths are the same (not proportional to their improvement)</span></span>
<span id="cb16-3"><a href=""></a>big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href=""></a>  <span class="fu">rpart.plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-15-1.png" width="864"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="co"># We can make it a little easier by playing around with</span></span>
<span id="cb17-2"><a href=""></a><span class="co"># font size (cex) and removing some node details (type = 0)</span></span>
<span id="cb17-3"><a href=""></a>big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href=""></a>  <span class="fu">rpart.plot</span>(<span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">type =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-15-2.png" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a><span class="co"># This tree (1) is easier to read; and (2) plots branch lengths proportional to their improvement</span></span>
<span id="cb18-2"><a href=""></a><span class="co"># But it has less info about classification accuracy</span></span>
<span id="cb18-3"><a href=""></a>big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href=""></a>  <span class="fu">plot</span>()</span>
<span id="cb18-6"><a href=""></a>big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href=""></a>  <span class="fu">text</span>(<span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-16-1.png" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Use the <em>second</em> tree plot to answer the following questions.</p>
<ol type="a">
<li>Are any land types <em>not</em> captured somewhere in the tree: asphalt, building, car, concrete, grass, pool, shadow, soil, tree? If so, why do you think this is?</li>
<li>This tree considered all 147 possible predictors. Do all of these appear in the final tree?</li>
<li>Of the predictors used in the tree, which seem to be the most important?</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>Yes</li>
<li>No</li>
<li>NDVI, Mean_G_40, Bright_100, ShpIndx_100 (roughly)</li>
</ol>
</details>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-5-identifying-useful-predictors">Exercise 5: Identifying useful predictors</h3>
<p>Luckily, we don’t have to <em>guesstimate</em> the importance of different predictors.</p>
<p>There’s a mathematical metric: <strong>variable importance</strong>.</p>
<p>Roughly, a predictor’s importance measures the total improvement in node purity if we were to split on this predictor (even if the predictor isn’t ultimately used in a split).</p>
<p>The bigger the better!</p>
<p>Check out the importance of our 147 predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="co"># Check out just the 10 most important (for simplicity)</span></span>
<span id="cb19-2"><a href=""></a>big_tree <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href=""></a>  <span class="fu">pluck</span>(<span class="st">"variable.importance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href=""></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     NDVI_40         NDVI      NDVI_60       Mean_G    Bright_40    Mean_G_40 
   140.81912    136.74372    128.66465    117.47329    110.15678     95.89161 
     NDVI_80     NDVI_100     NDVI_120 Mean_NIR_100 
    84.91799     76.13970     71.44863     70.28818 </code></pre>
</div>
</div>
<p>And plot these to help with comparison:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a><span class="co"># By default, this plots only 10 predictors</span></span>
<span id="cb21-2"><a href=""></a><span class="co"># At most, it will plot only half of our predictors here</span></span>
<span id="cb21-3"><a href=""></a><span class="co"># (I'm not sure what the max is in general!)</span></span>
<span id="cb21-4"><a href=""></a><span class="fu">library</span>(vip)</span>
<span id="cb21-5"><a href=""></a>big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href=""></a>  <span class="fu">vip</span>(<span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">num_features =</span> <span class="dv">147</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li>What are the 3 most important predictors by this metric? Do these appear in our tree?</li>
<li><em>Why</em> do you think a predictor can have high importance but not appear in the tree? Name 2 reasons.</li>
<li>If you could pick only 3 predictors to model land type, would you pick the 3 with the highest importance? Explain.</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>NDVI_40, NDVI, NDVI_60. NDVI_60 is not in the tree.</li>
<li>Since variable importance metrics look at predictor contributions even when they aren’t used in the splits, some of the important variables aren’t even used in our tree. This is explained by: (1) these predictors might be highly correlated / multicollinear with other predictors that <em>do</em> show up in the tree (i.e.&nbsp;we don’t need both); and (2) greediness – earlier splits will, in part, determine what predictors are used later in the tree.</li>
<li>No.&nbsp;Given what we observed above, variable importance doesn’t tell us about the <em>combined</em> importance of a set of predictors, but their individual importance.</li>
</ol>
</details>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-6-how-good-is-the-tree-part-1">Exercise 6: How good is the tree?!? Part 1</h3>
<p>Stepping back, our goal for building this tree was to classify land type for a pixel in an image.</p>
<p>As an example, suppose we have a pixel in an image like the first one in our data set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a><span class="fu">head</span>(land, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  type BrdIndx Area Round Bright Compact ShpIndx Mean_G Mean_R Mean_NIR  SD_G
1 car     1.27   91  0.97 231.38    1.39    1.47 207.92 241.74   244.48 21.41
  SD_R SD_NIR   LW GLCM1 Rect GLCM2 Dens Assym  NDVI BordLngth   GLCM3
1 20.4  18.69 2.19  0.48 0.87  6.23  1.6  0.74 -0.08        56 4219.69
  BrdIndx_40 Area_40 Round_40 Bright_40 Compact_40 ShpIndx_40 Mean_G_40
1       1.33      97     1.12    227.19       1.32       1.42    203.95
  Mean_R_40 Mean_NIR_40 SD_G_40 SD_R_40 SD_NIR_40 LW_40 GLCM1_40 Rect_40
1    237.23      240.38   27.63   28.36     26.18     2      0.5    0.85
  GLCM2_40 Dens_40 Assym_40 NDVI_40 BordLngth_40 GLCM3_40 BrdIndx_60 Area_60
1     6.29    1.67      0.7   -0.08           56  3806.36       1.33      97
  Round_60 Bright_60 Compact_60 ShpIndx_60 Mean_G_60 Mean_R_60 Mean_NIR_60
1     1.12    227.19       1.32       1.42    203.95    237.23      240.38
  SD_G_60 SD_R_60 SD_NIR_60 LW_60 GLCM1_60 Rect_60 GLCM2_60 Dens_60 Assym_60
1   27.63   28.36     26.18     2      0.5    0.85     6.29    1.67      0.7
  NDVI_60 BordLngth_60 GLCM3_60 BrdIndx_80 Area_80 Round_80 Bright_80
1   -0.08           56  3806.36       1.33      97     1.12    227.19
  Compact_80 ShpIndx_80 Mean_G_80 Mean_R_80 Mean_NIR_80 SD_G_80 SD_R_80
1       1.32       1.42    203.95    237.23      240.38   27.63   28.36
  SD_NIR_80 LW_80 GLCM1_80 Rect_80 GLCM2_80 Dens_80 Assym_80 NDVI_80
1     26.18     2      0.5    0.85     6.29    1.67      0.7   -0.08
  BordLngth_80 GLCM3_80 BrdIndx_100 Area_100 Round_100 Bright_100 Compact_100
1           56  3806.36        1.33       97      1.12     227.19        1.32
  ShpIndx_100 Mean_G_100 Mean_R_100 Mean_NIR_100 SD_G_100 SD_R_100 SD_NIR_100
1        1.42     203.95     237.23       240.38    27.63    28.36      26.18
  LW_100 GLCM1_100 Rect_100 GLCM2_100 Dens_100 Assym_100 NDVI_100 BordLngth_100
1      2       0.5     0.85      6.29     1.67       0.7    -0.08            56
  GLCM3_100 BrdIndx_120 Area_120 Round_120 Bright_120 Compact_120 ShpIndx_120
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
  Mean_G_120 Mean_R_120 Mean_NIR_120 SD_G_120 SD_R_120 SD_NIR_120 LW_120
1     203.95     237.23       240.38    27.63    28.36      26.18      2
  GLCM1_120 Rect_120 GLCM2_120 Dens_120 Assym_120 NDVI_120 BordLngth_120
1       0.5     0.85      6.29     1.67       0.7    -0.08            56
  GLCM3_120 BrdIndx_140 Area_140 Round_140 Bright_140 Compact_140 ShpIndx_140
1   3806.36        1.33       97      1.12     227.19        1.32        1.42
  Mean_G_140 Mean_R_140 Mean_NIR_140 SD_G_140 SD_R_140 SD_NIR_140 LW_140
1     203.95     237.23       240.38    27.63    28.36      26.18      2
  GLCM1_140 Rect_140 GLCM2_140 Dens_140 Assym_140 NDVI_140 BordLngth_140
1       0.5     0.85      6.29     1.67       0.7    -0.08            56
  GLCM3_140
1   3806.36</code></pre>
</div>
</div>
<p>Our tree correctly predicts that this is a car:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> <span class="fu">head</span>(land, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  .pred_class
  &lt;fct&gt;      
1 "car "     </code></pre>
</div>
</div>
<p>But how good are the classifications overall?</p>
<p>Let’s first consider the CV <em>overall accuracy rate</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a><span class="co"># reminder of our chosen tuning parameter</span></span>
<span id="cb26-2"><a href=""></a>parsimonious_param_big</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  cost_complexity .config              
            &lt;dbl&gt; &lt;chr&gt;                
1         0.00681 Preprocessor1_Model06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a><span class="co"># pull out metrics for just that value of tuning parameter</span></span>
<span id="cb28-2"><a href=""></a>tree_models_big <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href=""></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href=""></a>  <span class="fu">filter</span>(cost_complexity <span class="sc">==</span> parsimonious_param_big<span class="sc">$</span>cost_complexity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  cost_complexity .metric  .estimator  mean     n std_err .config              
            &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
1         0.00681 accuracy multiclass 0.804    10  0.0172 Preprocessor1_Model06</code></pre>
</div>
</div>
<ol type="a">
<li><p><em>Interpret</em> 0.804, the CV overall accuracy rate for the <code>big_tree</code>.</p></li>
<li><p>Calculate &amp; compare the tree’s CV overall accuracy rate to the <strong>no information rate</strong>: is the <code>big_tree</code> better than just always guessing the most common land type? You’ll need the following info:</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a>land <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href=""></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 675</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a>land <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href=""></a>  <span class="fu">count</span>(type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       type   n
1  asphalt   59
2 building  122
3      car   36
4 concrete  116
5    grass  112
6     pool   29
7   shadow   61
8     soil   34
9     tree  106</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>Why can’t we calculate, thus compare, the sensitivity &amp; specificity of our tree? HINT: Think of how these are defined.</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>We estimate that our <code>big_tree</code> will correctly classify roughly 80% of <em>new</em> pixel in an image.</li>
<li>The tree’s accuracy is much better than the <strong>no information rate</strong> of 18% associated with always guessing “building”.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href=""></a><span class="dv">122</span><span class="sc">/</span><span class="dv">675</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1807407</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>sensitivity &amp; specificity measure the accuracy of classifications for <strong>binary</strong> outcomes y.</li>
</ol>
</details>
<h3 class="unnumbered" id="exercise-7-how-good-is-the-tree-part-2">Exercise 7: How good is the tree?!? Part 2</h3>
<p>The above CV metric gives us a sense of the <em>overall</em> quality of using our tree to classify a <em>new</em> pixel in an image.</p>
<p>But it doesn’t give any insight into the quality of classifications for any particular land type.</p>
<p>To that end, let’s consider the <em>in-sample</em> confusion matrix (i.e.&nbsp;how well our tree classified the pixels in an image in our sample).</p>
<p>NOTE: We could also get a CV version, but the code is long and the CV accuracy will do for now!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a>in_sample_confusion <span class="ot">&lt;-</span> big_tree <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href=""></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> land) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href=""></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> type, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb36-4"><a href=""></a></span>
<span id="cb36-5"><a href=""></a>in_sample_confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Truth
Prediction  asphalt  building  car  concrete  grass  pool  shadow  soil  tree 
  asphalt         57         3    2         0      0     0       1     0     0
  building         0       116    0        16      1     0       0     5     0
  car              0         0   33         2      0     2       0     0     0
  concrete         1         3    1        98      0     0       0     9     1
  grass            0         0    0         0    102     1       0     3     9
  pool             0         0    0         0      0    26       0     0     0
  shadow           1         0    0         0      0     0      59     0     1
  soil             0         0    0         0      0     0       0    17     0
  tree             0         0    0         0      9     0       1     0    95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a><span class="co"># The mosaic plot of this matrix is too messy to be very useful here</span></span>
<span id="cb38-2"><a href=""></a>in_sample_confusion <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href=""></a>  <span class="fu">autoplot</span>() <span class="sc">+</span>    </span>
<span id="cb38-4"><a href=""></a>  <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">rep</span>(<span class="fu">colnames</span>(in_sample_confusion<span class="sc">$</span>table), <span class="fu">ncol</span>(in_sample_confusion<span class="sc">$</span>table))) <span class="sc">+</span> </span>
<span id="cb38-5"><a href=""></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"darkgray"</span>, <span class="st">"red"</span>, <span class="st">"#7570B3"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>, <span class="st">"#E6AB02"</span>, <span class="st">"brown"</span>, <span class="st">"#66A61E"</span>)) <span class="sc">+</span> </span>
<span id="cb38-6"><a href=""></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-24-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li>Confirm that 96.6% of asphalt pixels in an image were correctly classified as asphalt.</li>
<li>What land type was the <em>hardest</em> for the tree to classify? Why might this be?</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>57 / (57 + 1 + 1) = 0.966</li>
<li>soil. probably because it had one of the smallest numbers of data points. and the predictor values of soil images must be similar to / hard to distinguish from the predictor values of other types of images.</li>
</ol>
</details>
</section>
<section id="part-2" class="slide level2 unnumbered smaller scrollable">
<h2>Part 2</h2>
<p>Just like KNN, trees can be applied in both regression <em>and</em> classification settings.</p>
<p>Thus trees add to our collection of <em>nonparametric</em> regression techniques, including KNN, LOESS, and GAM.</p>
<p>To explore, we’ll use regression trees to model the <code>body_mass_g</code> of penguins by their <code>bill_length_mm</code> and <code>species</code>. <em>This is for demonstration purposes only!!!</em></p>
<p>As the plot below demonstrates, this relationship isn’t complicated enough to justify using a nonparametric algorithm:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a><span class="fu">data</span>(penguins)</span>
<span id="cb39-2"><a href=""></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">y =</span> body_mass_g, <span class="at">x =</span> bill_length_mm, <span class="at">color =</span> species)) <span class="sc">+</span> </span>
<span id="cb39-3"><a href=""></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Run the following code to build a regression tree of this relationship.</p>
<p>Pause to reflect upon the questions in the comments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a><span class="co"># CHUNK GOAL</span></span>
<span id="cb40-2"><a href=""></a><span class="co"># Build a bunch of trees using different cost complexity parameters</span></span>
<span id="cb40-3"><a href=""></a></span>
<span id="cb40-4"><a href=""></a><span class="co"># STEP 1: regression tree specification</span></span>
<span id="cb40-5"><a href=""></a><span class="co"># QUESTION: How does this differ from our classification tree specification?</span></span>
<span id="cb40-6"><a href=""></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-9"><a href=""></a>  <span class="fu">set_args</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),  </span>
<span id="cb40-10"><a href=""></a>           <span class="at">min_n =</span> <span class="dv">2</span>, </span>
<span id="cb40-11"><a href=""></a>           <span class="at">tree_depth =</span> <span class="dv">20</span>)</span>
<span id="cb40-12"><a href=""></a></span>
<span id="cb40-13"><a href=""></a><span class="co"># STEP 2: variable recipe</span></span>
<span id="cb40-14"><a href=""></a><span class="co"># NOTHING IS NEW HERE!</span></span>
<span id="cb40-15"><a href=""></a>variable_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(body_mass_g <span class="sc">~</span> bill_length_mm <span class="sc">+</span> species, <span class="at">data =</span> penguins)</span>
<span id="cb40-16"><a href=""></a></span>
<span id="cb40-17"><a href=""></a><span class="co"># STEP 3: tree workflow</span></span>
<span id="cb40-18"><a href=""></a><span class="co"># NOTHING IS NEW HERE!</span></span>
<span id="cb40-19"><a href=""></a>tree_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-20"><a href=""></a>  <span class="fu">add_recipe</span>(variable_recipe) <span class="sc">%&gt;%</span> </span>
<span id="cb40-21"><a href=""></a>  <span class="fu">add_model</span>(tree_spec)</span>
<span id="cb40-22"><a href=""></a></span>
<span id="cb40-23"><a href=""></a><span class="co"># STEP 4: Estimate multiple trees using a range of possible cost complexity values</span></span>
<span id="cb40-24"><a href=""></a><span class="co"># QUESTION: How do the CV metrics differ from our classification tree?</span></span>
<span id="cb40-25"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">253</span>)</span>
<span id="cb40-26"><a href=""></a>tree_models <span class="ot">&lt;-</span> tree_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb40-27"><a href=""></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb40-28"><a href=""></a>    <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)), <span class="at">levels =</span> <span class="dv">10</span>),</span>
<span id="cb40-29"><a href=""></a>    <span class="at">resamples =</span> <span class="fu">vfold_cv</span>(penguins, <span class="at">v =</span> <span class="dv">10</span>),</span>
<span id="cb40-30"><a href=""></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(mae)</span>
<span id="cb40-31"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a><span class="co"># CHUNK GOAL:</span></span>
<span id="cb41-2"><a href=""></a><span class="co"># Finalize the tree using the parsimonious cost complexity parameter</span></span>
<span id="cb41-3"><a href=""></a><span class="co"># NOTHING IS NEW HERE</span></span>
<span id="cb41-4"><a href=""></a></span>
<span id="cb41-5"><a href=""></a><span class="co"># Identify the parsimonious cost complexityparameter</span></span>
<span id="cb41-6"><a href=""></a>parsimonious_param <span class="ot">&lt;-</span> tree_models <span class="sc">%&gt;%</span> </span>
<span id="cb41-7"><a href=""></a>  <span class="fu">select_by_one_std_err</span>(<span class="at">metric =</span> <span class="st">"mae"</span>, <span class="fu">desc</span>(cost_complexity))</span>
<span id="cb41-8"><a href=""></a></span>
<span id="cb41-9"><a href=""></a><span class="co"># Finalize the tree with parsimonious cost complexity</span></span>
<span id="cb41-10"><a href=""></a>regression_tree <span class="ot">&lt;-</span> tree_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb41-11"><a href=""></a>  <span class="fu">finalize_workflow</span>(<span class="at">parameters =</span> parsimonious_param) <span class="sc">%&gt;%</span> </span>
<span id="cb41-12"><a href=""></a>  <span class="fu">fit</span>(<span class="at">data =</span> penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-8-regression-tree">Exercise 8: Regression tree</h3>
<p>Check out the resulting regression tree:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href=""></a><span class="co"># This code is the same as for classification trees!</span></span>
<span id="cb42-2"><a href=""></a>regression_tree <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href=""></a>  <span class="fu">rpart.plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li>Use your tree (by “hand”) to predict the body mass for the 2 following penguins:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a>new_penguins <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species =</span> <span class="fu">c</span>(<span class="st">"Adelie"</span>, <span class="st">"Gentoo"</span>), <span class="at">bill_length_mm =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">45</span>))</span>
<span id="cb43-2"><a href=""></a>new_penguins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  species bill_length_mm
1  Adelie             45
2  Gentoo             45</code></pre>
</div>
</div>
<ol start="2" type="a">
<li>Check your work in part a:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a>regression_tree <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href=""></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> new_penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .pred species bill_length_mm
  &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 4192. Adelie              45
2 4782. Gentoo              45</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>Regression trees partition the data points into separate prediction regions. Check out this tree’s predictions (dark dots) and convince yourself that these are consistent with the tree:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href=""></a>regression_tree <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href=""></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> penguins) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> body_mass_g, <span class="at">color =</span> species)) <span class="sc">+</span> </span>
<span id="cb47-4"><a href=""></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb47-5"><a href=""></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm, <span class="at">y =</span> .pred, <span class="at">color =</span> species), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href=""></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> species) <span class="sc">+</span> </span>
<span id="cb47-7"><a href=""></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L14-knn-trees-2_files/figure-html/unnamed-chunk-31-1.png" width="576"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="a">
<li>Based on what you’ve observed here, what do you think is a drawback of regression trees?</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>4192 and 4782</li>
<li>same as a</li>
<li>…</li>
<li>at least in this example, the regression tree greatly oversimplifies the relationship of body mass with species and bill length</li>
</ol>
</details>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-9-visual-essay">Exercise 9: Visual essay</h3>
<p>Check out this <a href="http://www.r2d3.us/visual-intro-to-machine-learning-part-1/">visual essay</a> on trees!</p>
<p><br>
<br>
</p>
<h3 class="unnumbered" id="exercise-10-work-on-homework">Exercise 10: Work on Homework</h3>
<p>With your remaining time, work on HW5.</p>
<p><br></p>
</section></section>
<section id="wrapping-up" class="title-slide slide level1 unnumbered center">
<h1>Wrapping Up</h1>
<ul>
<li>As usual, take time after class to finish any remaining exercises, check solutions, reflect on key concepts from today, and come to office hours with questions</li>
<li><mark>IMPORTANT: If you are eligible to vote and have not already done so, please do!</mark> Polls close at 8 pm.</li>
<li>Upcoming due dates:
<ul>
<li>HW5: due next week (Nov 13)</li>
<li>HW4 Revisions: due next week (Nov 13)</li>
<li>Quiz 2: two weeks from today (Nov 19)</li>
</ul></li>
</ul>
<p><br></p>
</section>

<section>
<section id="notes-r-code" class="title-slide slide level1 unnumbered center">
<h1>Notes: R Code</h1>

</section>
<section id="r-code-knn" class="slide level2 unnumbered">
<h2>R code: KNN</h2>
<p>Suppose we want to build a KNN model of some categorical response variable y using predictors x1 and x2 in our sample_data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href=""></a><span class="co"># Load packages</span></span>
<span id="cb48-2"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb48-3"><a href=""></a><span class="fu">library</span>(kknn)</span>
<span id="cb48-4"><a href=""></a></span>
<span id="cb48-5"><a href=""></a><span class="co"># Resolves package conflicts by preferring tidymodels functions</span></span>
<span id="cb48-6"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Make sure that y is a factor variable</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href=""></a>sample_data <span class="ot">&lt;-</span> sample_data <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">as.factor</span>(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Build models for a variety of tuning parameters K</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href=""></a><span class="co"># STEP 1: KNN model specification</span></span>
<span id="cb50-2"><a href=""></a>knn_spec <span class="ot">&lt;-</span> <span class="fu">nearest_neighbor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"kknn"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href=""></a>  <span class="fu">set_args</span>(<span class="at">neighbors =</span> <span class="fu">tune</span>())</span>
<span id="cb50-6"><a href=""></a></span>
<span id="cb50-7"><a href=""></a><span class="co"># STEP 2: variable recipe</span></span>
<span id="cb50-8"><a href=""></a>variable_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> sample_data) <span class="sc">%&gt;%</span> </span>
<span id="cb50-9"><a href=""></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb50-10"><a href=""></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb50-11"><a href=""></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb50-12"><a href=""></a></span>
<span id="cb50-13"><a href=""></a><span class="co"># STEP 3: KNN workflow</span></span>
<span id="cb50-14"><a href=""></a>knn_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-15"><a href=""></a>  <span class="fu">add_recipe</span>(variable_recipe) <span class="sc">%&gt;%</span> </span>
<span id="cb50-16"><a href=""></a>  <span class="fu">add_model</span>(knn_spec)</span>
<span id="cb50-17"><a href=""></a></span>
<span id="cb50-18"><a href=""></a><span class="co"># STEP 4: Estimate multiple KNN models using a range of possible K values</span></span>
<span id="cb50-19"><a href=""></a><span class="fu">set.seed</span>(___)</span>
<span id="cb50-20"><a href=""></a>knn_models <span class="ot">&lt;-</span> knn_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb50-21"><a href=""></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb50-22"><a href=""></a>    <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">neighbors</span>(<span class="at">range =</span> <span class="fu">c</span>(___, ___)), <span class="at">levels =</span> ___),</span>
<span id="cb50-23"><a href=""></a>    <span class="at">resamples =</span> <span class="fu">vfold_cv</span>(sample_data, <span class="at">v =</span> ___),</span>
<span id="cb50-24"><a href=""></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy)</span>
<span id="cb50-25"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Tuning K</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href=""></a><span class="co"># Calculate CV accuracy for each KNN model</span></span>
<span id="cb51-2"><a href=""></a>knn_models <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href=""></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb51-4"><a href=""></a></span>
<span id="cb51-5"><a href=""></a><span class="co"># Plot CV accuracy (y-axis) for the KNN model from each K (x-axis)</span></span>
<span id="cb51-6"><a href=""></a>knn_models <span class="sc">%&gt;%</span> </span>
<span id="cb51-7"><a href=""></a>  <span class="fu">autoplot</span>()</span>
<span id="cb51-8"><a href=""></a></span>
<span id="cb51-9"><a href=""></a><span class="co"># Identify K which produced the highest (best) CV accuracy</span></span>
<span id="cb51-10"><a href=""></a>best_K <span class="ot">&lt;-</span> <span class="fu">select_best</span>(knn_models, <span class="at">metric =</span> <span class="st">"accuracy"</span>)</span>
<span id="cb51-11"><a href=""></a>best_K</span>
<span id="cb51-12"><a href=""></a></span>
<span id="cb51-13"><a href=""></a><span class="co"># Get the CV accuracy for KNN when using best_K</span></span>
<span id="cb51-14"><a href=""></a>knn_models <span class="sc">%&gt;%</span> </span>
<span id="cb51-15"><a href=""></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-16"><a href=""></a>  <span class="fu">filter</span>(neighbors <span class="sc">==</span> best_K<span class="sc">$</span>neighbors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Finalizing the “best” KNN model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href=""></a>final_knn_model <span class="ot">&lt;-</span> knn_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href=""></a>  <span class="fu">finalize_workflow</span>(<span class="at">parameters =</span> best_k) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href=""></a>  <span class="fu">fit</span>(<span class="at">data =</span> sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Use the KNN to make predictions / classifications</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href=""></a><span class="co"># Put in a data.frame object with x1 and x2 values (at minimum)</span></span>
<span id="cb53-2"><a href=""></a>final_knn_model <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> ___)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
<br>
<br>
<br>
<br>
</p>
</section>
<section id="r-code-trees" class="slide level2 unnumbered">
<h2>R code: trees</h2>
<p>Suppose we want to build a tree of some categorical response variable y using predictors x1 and x2 in our sample_data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href=""></a><span class="co"># Load packages</span></span>
<span id="cb54-2"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb54-3"><a href=""></a><span class="fu">library</span>(rpart)</span>
<span id="cb54-4"><a href=""></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb54-5"><a href=""></a></span>
<span id="cb54-6"><a href=""></a><span class="co"># Resolves package conflicts by preferring tidymodels functions</span></span>
<span id="cb54-7"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Make sure that y is a factor variable</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href=""></a>sample_data <span class="ot">&lt;-</span> sample_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">as.factor</span>(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Build trees for a variety of tuning parameters</strong></p>
<p>We’ll focus on optimizing the <code>cost_complexity</code> parameter, while setting <code>min_n</code> and <code>tree_depth</code> to fixed numbers. For example, setting <code>min_n</code> to 2 and <code>tree_depth</code> to 30 set only loose restrictions, letting <code>cost_complexity</code> do the pruning work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href=""></a><span class="co"># STEP 1: tree specification</span></span>
<span id="cb56-2"><a href=""></a><span class="co"># If y is quantitative, change "classification" to "regression"</span></span>
<span id="cb56-3"><a href=""></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-5"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-6"><a href=""></a>  <span class="fu">set_args</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),  </span>
<span id="cb56-7"><a href=""></a>           <span class="at">min_n =</span> <span class="dv">2</span>, </span>
<span id="cb56-8"><a href=""></a>           <span class="at">tree_depth =</span> <span class="dv">30</span>)</span>
<span id="cb56-9"><a href=""></a></span>
<span id="cb56-10"><a href=""></a><span class="co"># STEP 2: variable recipe</span></span>
<span id="cb56-11"><a href=""></a><span class="co"># There are no necessary preprocessing steps for trees!</span></span>
<span id="cb56-12"><a href=""></a>variable_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> sample_data)</span>
<span id="cb56-13"><a href=""></a></span>
<span id="cb56-14"><a href=""></a><span class="co"># STEP 3: tree workflow</span></span>
<span id="cb56-15"><a href=""></a>tree_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-16"><a href=""></a>  <span class="fu">add_recipe</span>(variable_recipe) <span class="sc">%&gt;%</span> </span>
<span id="cb56-17"><a href=""></a>  <span class="fu">add_model</span>(tree_spec)</span>
<span id="cb56-18"><a href=""></a></span>
<span id="cb56-19"><a href=""></a><span class="co"># STEP 4: Estimate multiple trees using a range of possible cost complexity values</span></span>
<span id="cb56-20"><a href=""></a><span class="co"># - If y is quantitative, change "accuracy" to "mae"</span></span>
<span id="cb56-21"><a href=""></a><span class="co"># - cost_complexity is on the log10 scale (10^(-5) to 10^(0.1))</span></span>
<span id="cb56-22"><a href=""></a><span class="co">#   I start with a range from -5 to 2 and then tweak</span></span>
<span id="cb56-23"><a href=""></a><span class="fu">set.seed</span>(___)</span>
<span id="cb56-24"><a href=""></a>tree_models <span class="ot">&lt;-</span> tree_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb56-25"><a href=""></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb56-26"><a href=""></a>    <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(<span class="at">range =</span> <span class="fu">c</span>(___, ___)), <span class="at">levels =</span> ___),</span>
<span id="cb56-27"><a href=""></a>    <span class="at">resamples =</span> <span class="fu">vfold_cv</span>(sample_data, <span class="at">v =</span> ___),</span>
<span id="cb56-28"><a href=""></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy)</span>
<span id="cb56-29"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Tuning cost complexity</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href=""></a><span class="co"># Plot the CV accuracy vs cost complexity for our trees</span></span>
<span id="cb57-2"><a href=""></a><span class="co"># x-axis is on the original (not log10) scale</span></span>
<span id="cb57-3"><a href=""></a>tree_models <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href=""></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb57-5"><a href=""></a>  <span class="fu">scale_x_continuous</span>()</span>
<span id="cb57-6"><a href=""></a></span>
<span id="cb57-7"><a href=""></a><span class="co"># Identify cost complexity which produced the highest CV accuracy</span></span>
<span id="cb57-8"><a href=""></a>best_cost <span class="ot">&lt;-</span> tree_models <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href=""></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>)</span>
<span id="cb57-10"><a href=""></a></span>
<span id="cb57-11"><a href=""></a><span class="co"># Get the CV accuracy when using best_cost</span></span>
<span id="cb57-12"><a href=""></a>tree_models <span class="sc">%&gt;%</span> </span>
<span id="cb57-13"><a href=""></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb57-14"><a href=""></a>  <span class="fu">filter</span>(cost_complexity <span class="sc">==</span> best_cost<span class="sc">$</span>cost_complexity)</span>
<span id="cb57-15"><a href=""></a></span>
<span id="cb57-16"><a href=""></a><span class="co"># Identify cost complexity which produced the parsimonious tree</span></span>
<span id="cb57-17"><a href=""></a>parsimonious_cost <span class="ot">&lt;-</span> tree_models <span class="sc">%&gt;%</span> </span>
<span id="cb57-18"><a href=""></a>  <span class="fu">select_by_one_std_err</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>, <span class="fu">desc</span>(cost_complexity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Finalizing the tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href=""></a><span class="co"># Plug in best_cost or parsimonious_cost</span></span>
<span id="cb58-2"><a href=""></a>final_tree <span class="ot">&lt;-</span> tree_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href=""></a>  <span class="fu">finalize_workflow</span>(<span class="at">parameters =</span> ___) <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href=""></a>  <span class="fu">fit</span>(<span class="at">data =</span> sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Plot the tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href=""></a><span class="co"># Tree with accuracy info in each node</span></span>
<span id="cb59-2"><a href=""></a><span class="co"># Branches are NOT proportional to classification improvement</span></span>
<span id="cb59-3"><a href=""></a>final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href=""></a>  <span class="fu">rpart.plot</span>()</span>
<span id="cb59-6"><a href=""></a></span>
<span id="cb59-7"><a href=""></a><span class="co"># Tree withOUT accuracy info in each node</span></span>
<span id="cb59-8"><a href=""></a><span class="co"># Branches ARE proportional to classification improvement</span></span>
<span id="cb59-9"><a href=""></a>final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb59-10"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-11"><a href=""></a>  <span class="fu">plot</span>()</span>
<span id="cb59-12"><a href=""></a>final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb59-13"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-14"><a href=""></a>  <span class="fu">text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Use the tree to make predictions / classifications</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href=""></a><span class="co"># Put in a data.frame object with x1 and x2 values (at minimum)</span></span>
<span id="cb60-2"><a href=""></a>final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> ___)  </span>
<span id="cb60-4"><a href=""></a></span>
<span id="cb60-5"><a href=""></a><span class="co"># OR </span></span>
<span id="cb60-6"><a href=""></a>final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href=""></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Examine variable importance</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href=""></a><span class="co"># Print the metrics</span></span>
<span id="cb61-2"><a href=""></a>final_tree <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href=""></a>  <span class="fu">pluck</span>(<span class="st">"variable.importance"</span>)</span>
<span id="cb61-5"><a href=""></a></span>
<span id="cb61-6"><a href=""></a><span class="co"># Plot the metrics</span></span>
<span id="cb61-7"><a href=""></a><span class="co"># Plug in the number of top predictors you wish to plot</span></span>
<span id="cb61-8"><a href=""></a><span class="co"># (The upper limit varies by application!)</span></span>
<span id="cb61-9"><a href=""></a><span class="fu">library</span>(vip)</span>
<span id="cb61-10"><a href=""></a>final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb61-11"><a href=""></a>  <span class="fu">vip</span>(<span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">num_features =</span> ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Evaluate the classifications using in-sample metrics</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href=""></a><span class="co"># Get the in-sample confusion matrix</span></span>
<span id="cb62-2"><a href=""></a>in_sample_confusion <span class="ot">&lt;-</span> final_tree <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href=""></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> sample_data) <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href=""></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> type, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb62-5"><a href=""></a>in_sample_confusion</span>
<span id="cb62-6"><a href=""></a></span>
<span id="cb62-7"><a href=""></a><span class="co"># Plot the matrix using a mosaic plot</span></span>
<span id="cb62-8"><a href=""></a><span class="co"># See exercise for what to do when there are more categories than colors in our pallette!</span></span>
<span id="cb62-9"><a href=""></a>in_sample_confusion <span class="sc">%&gt;%</span> </span>
<span id="cb62-10"><a href=""></a>  <span class="fu">autoplot</span>() <span class="sc">+</span>    </span>
<span id="cb62-11"><a href=""></a>  <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">rep</span>(<span class="fu">colnames</span>(in_sample_confusion<span class="sc">$</span>table), <span class="fu">ncol</span>(in_sample_confusion<span class="sc">$</span>table))) <span class="sc">+</span> </span>
<span id="cb62-12"><a href=""></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-auto-generated-content">
<p><img src="images/mac.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://kegrinde.github.io/stat253_coursenotes" class="uri">https://kegrinde.github.io/stat253_coursenotes</a></p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="L14-knn-trees-2_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="L14-knn-trees-2_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":"17298895842689101304","id":"e003b432cd4a755a","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>