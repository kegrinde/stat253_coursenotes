<!DOCTYPE html>
<html lang="en"><head>
<script src="L15-forests_files/libs/clipboard/clipboard.min.js"></script>
<script src="L15-forests_files/libs/quarto-html/tabby.min.js"></script>
<script src="L15-forests_files/libs/quarto-html/popper.min.js"></script>
<script src="L15-forests_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="L15-forests_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="L15-forests_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="L15-forests_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="L15-forests_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.555">

  <title>Random forests &amp; bagging</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="L15-forests_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="L15-forests_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="L15-forests_files/libs/revealjs/dist/theme/quarto.css">
  <link href="L15-forests_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="L15-forests_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="L15-forests_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="L15-forests_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="L15-forests_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="L15-forests_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Random forests &amp; bagging</h1>

<div class="quarto-title-authors">
</div>

</section>
<section>
<section id="settling-in" class="title-slide slide level1 unnumbered center">
<h1>Settling In</h1>
<ul>
<li>Sit with the same group as last class.
<ul>
<li>Ask your groupmates what classes they are planning to take next semester!</li>
</ul></li>
<li>Locate and open today’s QMD</li>
<li>Catch up on announcements and messages on Slack <!--- Check your Feedback Spreadsheet for recent updates--></li>
</ul>
</section>
<section id="registration-tips" class="slide level2 unnumbered smaller">
<h2>Registration Tips</h2>
<p>Thinking about what MSCS course to take next semester? Consider the following:</p>
<ul>
<li>Interested in working with <em><strong>data</strong></em> (eg wrangling, plotting, data acquisition, advanced data processing)? Try:
<ul>
<li>COMP/STAT 112 (Intro to Data Science)</li>
<li>COMP/STAT 212 (Intermediate Data Science)</li>
</ul></li>
<li>Interested in data and its connection to <em><strong>public health</strong></em>? Try:
<ul>
<li>STAT 125 (Epidemiology)</li>
<li><mark>STAT 494 (Statistical Genetics)</mark></li>
</ul></li>
<li>Interested in developing a <em><strong>mathematical</strong></em> foundation for better/deeper understanding of statistical methodology? Try:
<ul>
<li><mark>MATH/STAT 354 (Probability)</mark></li>
<li><mark>MATH/STAT 355 (Statistical Theory)</mark></li>
<li>COMP/MATH 365 (Computational Linear Algebra)</li>
</ul></li>
<li>Interested in learning some <em><strong>computing</strong></em> techniques that are fundamental to data science? Try:
<ul>
<li>COMP 123 (Core Concepts in Comp Sci)</li>
<li>COMP 127 (Object-Oriented Programming and Abstraction)</li>
<li>COMP 302 (Introduction to Database Management Systems)</li>
</ul></li>
</ul>
<p><mark>NOTE:</mark> all of the highlighted courses above require permission of instructor to register. Fill out the corresponding interest form by the end of the day <mark>TODAY</mark> if you’re interested in taking any of these courses: <a href="https://www.macalester.edu/mscs/mscs-course-waitlists/">https://www.macalester.edu/mscs/mscs-course-waitlists/</a></p>
<p><br></p>
<p>More generally, use this shiny app (created by Prof Brianna Heggeseth) to help explore courses being offered next semester: <a href="https://bheggeseth.shinyapps.io/Spring2025Courses/">https://bheggeseth.shinyapps.io/Spring2025Courses/</a></p>
<p><br></p>
</section>
<section id="where-are-we" class="slide level2 unnumbered smaller">
<h2>Where Are We?</h2>
<p>Let’s check out the table of contents in <a href="https://www.statlearning.com/">our textbook</a>…</p>
<div class="fragment">
<p>We’ve covered so far:</p>
<ul>
<li>Chapter 2</li>
<li>Chapter 3</li>
<li>Chapter 4 (except 4.4–4.6, which we won’t cover)</li>
<li>Chapter 5</li>
<li>Chapter 6 (except 6.3, but we’ll get there)</li>
<li>Chapter 7 (we focused on 7.1, 7.6–7.7)</li>
<li>Chapter 8 (doing more today…)</li>
</ul>
</div>
<div class="fragment">
<p>After this, we’ll cover:</p>
<ul>
<li>Chapter 12</li>
<li>Chapter 6.3</li>
</ul>
</div>
<div class="fragment">
<p>Curious about some of the other chapters?</p>
<ul>
<li>Chapters 9 and 13: take Statistical Genetics</li>
<li>Chapter 10: take Introduction to Artificial Intelligence</li>
<li>Chapter 11: take Survival Analysis</li>
</ul>
<p><br></p>
<!-- build a shiny app comparing unpruned trees and forests across multiple datasets? -->
<!-- In light of the random forest algorithm, why should you NOT include a step_dummy(all_nominal_variables()) in your tidymodels recipe? -->
<!-- https://blog.methodsconsultants.com/posts/be-aware-of-bias-in-rf-variable-importance-metrics/ -->
<!-- https://blog.methodsconsultants.com/posts/be-aware-of-bias-in-rf-variable-importance-metrics/ -->
<!-- "Each time a break point is selected in a variable, every level of the variable is tested to find the best break point. Continuous or high cardinality variables will have many more split points, which results in the “multiple testing” problem. That is, there is a higher probability that by chance that variable happens to predict the outcome well, since variables where more splits are tried will appear more often in the tree." -->
<!-- The bagging resample trees tend to be very similar: there's often a small set of dominant predictors that will dominate the first splits, no matter the resample. Such correlation among the resample trees tends to increase the variability relative to random forests.     -->
<p><br>
<br>
</p>
</div>
</section></section>
<section>
<section id="small-group-discussion" class="title-slide slide level1 unnumbered center">
<h1>Small Group Discussion</h1>
<p>Discuss the following examples with your group.</p>
</section>
<section id="context" class="slide level2 unnumbered smaller">
<h2>Context</h2>
<p><img data-src="images/MLdiagram3.jpg" style="width:90.0%"></p>
<!--
<center>
<img src="images/MLdiagram3.jpg"/>
</center>
-->
<p>Within the broader machine learning landscape, we left off by discussing <strong>supervised classification techniques</strong>:</p>
<ul>
<li><strong>build a model</strong> of <em>categorical variable</em> y by predictors x
<ul>
<li>parametric model: logistic regression</li>
<li>nonparametric models: KNN &amp; trees</li>
</ul></li>
<li><strong>evaluate the model</strong><br>
We can use CV &amp; in-sample techniques to estimate the accuracy of our classification models.
<ul>
<li>for binary y: sensitivity, specificity, ROC curves</li>
<li>for y with any number of categories: overall accuracy rates, category specific accuracy rates</li>
</ul></li>
</ul>
<p><br>
</p>
<p><strong>TODAY’S GOAL</strong></p>
<p>Add more nonparametric algorithms to our toolkit: <strong>random forests</strong> &amp; <strong>bagging</strong></p>
<p><br></p>
</section>
<section id="example-1-anticipation" class="slide level2 unnumbered smaller">
<h2>EXAMPLE 1: Anticipation</h2>
<p>What does the word “forest” mean to you?</p>
<!-- note to self: switch this to a picture I took -->
<center>
<img src="images/forest.JPG" height="600">
</center>
<p><br></p>
</section>
<section id="example-2-candy" class="slide level2 unnumbered smaller">
<h2>EXAMPLE 2: Candy!!!</h2>
<p><a href="https://fivethirtyeight.com/videos/the-ultimate-halloween-candy-power-ranking/">fivethirtyeight article</a></p>
<p><a href="http://walthickey.com/2017/10/18/whats-the-best-halloween-candy/">the experiment</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href=""></a><span class="fu">library</span>(rpart)        <span class="co"># for building trees</span></span>
<span id="cb1-4"><a href=""></a><span class="fu">library</span>(rpart.plot)   <span class="co"># for plotting trees</span></span>
<span id="cb1-5"><a href=""></a><span class="fu">library</span>(randomForest) <span class="co"># for bagging &amp; forests</span></span>
<span id="cb1-6"><a href=""></a><span class="fu">library</span>(infer)        <span class="co"># for resampling</span></span>
<span id="cb1-7"><a href=""></a></span>
<span id="cb1-8"><a href=""></a><span class="fu">library</span>(fivethirtyeight)</span>
<span id="cb1-9"><a href=""></a><span class="fu">data</span>(<span class="st">"candy_rankings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">head</span>(candy_rankings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  competitorname chocolate fruity caramel peanutyalmondy nougat crispedricewafer
  &lt;chr&gt;          &lt;lgl&gt;     &lt;lgl&gt;  &lt;lgl&gt;   &lt;lgl&gt;          &lt;lgl&gt;  &lt;lgl&gt;           
1 100 Grand      TRUE      FALSE  TRUE    FALSE          FALSE  TRUE            
2 3 Musketeers   TRUE      FALSE  FALSE   FALSE          TRUE   FALSE           
3 One dime       FALSE     FALSE  FALSE   FALSE          FALSE  FALSE           
4 One quarter    FALSE     FALSE  FALSE   FALSE          FALSE  FALSE           
5 Air Heads      FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
6 Almond Joy     TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
# ℹ 6 more variables: hard &lt;lgl&gt;, bar &lt;lgl&gt;, pluribus &lt;lgl&gt;,
#   sugarpercent &lt;dbl&gt;, pricepercent &lt;dbl&gt;, winpercent &lt;dbl&gt;</code></pre>
</div>
</div>
<p><br></p>
<p>Write R code to find out the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="co"># What are the 6 most popular candies?</span></span>
<span id="cb4-2"><a href=""></a></span>
<span id="cb4-3"><a href=""></a></span>
<span id="cb4-4"><a href=""></a><span class="co"># The least popular?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution:
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="co"># What are the 6 most popular candies?</span></span>
<span id="cb5-2"><a href=""></a><span class="do">## OPTION 1</span></span>
<span id="cb5-3"><a href=""></a>candy_rankings <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href=""></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(winpercent)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href=""></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  competitorname chocolate fruity caramel peanutyalmondy nougat crispedricewafer
  &lt;chr&gt;          &lt;lgl&gt;     &lt;lgl&gt;  &lt;lgl&gt;   &lt;lgl&gt;          &lt;lgl&gt;  &lt;lgl&gt;           
1 Reese's Peanu… TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
2 Reese's Minia… TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
3 Twix           TRUE      FALSE  TRUE    FALSE          FALSE  TRUE            
4 Kit Kat        TRUE      FALSE  FALSE   FALSE          FALSE  TRUE            
5 Snickers       TRUE      FALSE  TRUE    TRUE           TRUE   FALSE           
6 Reese's pieces TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
# ℹ 6 more variables: hard &lt;lgl&gt;, bar &lt;lgl&gt;, pluribus &lt;lgl&gt;,
#   sugarpercent &lt;dbl&gt;, pricepercent &lt;dbl&gt;, winpercent &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="do">## OPTION 2</span></span>
<span id="cb7-2"><a href=""></a>candy_rankings <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href=""></a>  <span class="fu">slice_max</span>(winpercent, <span class="at">n =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  competitorname chocolate fruity caramel peanutyalmondy nougat crispedricewafer
  &lt;chr&gt;          &lt;lgl&gt;     &lt;lgl&gt;  &lt;lgl&gt;   &lt;lgl&gt;          &lt;lgl&gt;  &lt;lgl&gt;           
1 Reese's Peanu… TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
2 Reese's Minia… TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
3 Twix           TRUE      FALSE  TRUE    FALSE          FALSE  TRUE            
4 Kit Kat        TRUE      FALSE  FALSE   FALSE          FALSE  TRUE            
5 Snickers       TRUE      FALSE  TRUE    TRUE           TRUE   FALSE           
6 Reese's pieces TRUE      FALSE  FALSE   TRUE           FALSE  FALSE           
# ℹ 6 more variables: hard &lt;lgl&gt;, bar &lt;lgl&gt;, pluribus &lt;lgl&gt;,
#   sugarpercent &lt;dbl&gt;, pricepercent &lt;dbl&gt;, winpercent &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a><span class="co"># The least popular?</span></span>
<span id="cb9-2"><a href=""></a><span class="do">## OPTION 1</span></span>
<span id="cb9-3"><a href=""></a>candy_rankings <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href=""></a>  <span class="fu">arrange</span>(winpercent) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href=""></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  competitorname chocolate fruity caramel peanutyalmondy nougat crispedricewafer
  &lt;chr&gt;          &lt;lgl&gt;     &lt;lgl&gt;  &lt;lgl&gt;   &lt;lgl&gt;          &lt;lgl&gt;  &lt;lgl&gt;           
1 Nik L Nip      FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
2 Boston Baked … FALSE     FALSE  FALSE   TRUE           FALSE  FALSE           
3 Chiclets       FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
4 Super Bubble   FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
5 Jawbusters     FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
6 Root Beer Bar… FALSE     FALSE  FALSE   FALSE          FALSE  FALSE           
# ℹ 6 more variables: hard &lt;lgl&gt;, bar &lt;lgl&gt;, pluribus &lt;lgl&gt;,
#   sugarpercent &lt;dbl&gt;, pricepercent &lt;dbl&gt;, winpercent &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a><span class="do">## OPTION 2</span></span>
<span id="cb11-2"><a href=""></a>candy_rankings <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href=""></a>  <span class="fu">slice_min</span>(winpercent, <span class="at">n =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  competitorname chocolate fruity caramel peanutyalmondy nougat crispedricewafer
  &lt;chr&gt;          &lt;lgl&gt;     &lt;lgl&gt;  &lt;lgl&gt;   &lt;lgl&gt;          &lt;lgl&gt;  &lt;lgl&gt;           
1 Nik L Nip      FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
2 Boston Baked … FALSE     FALSE  FALSE   TRUE           FALSE  FALSE           
3 Chiclets       FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
4 Super Bubble   FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
5 Jawbusters     FALSE     TRUE   FALSE   FALSE          FALSE  FALSE           
6 Root Beer Bar… FALSE     FALSE  FALSE   FALSE          FALSE  FALSE           
# ℹ 6 more variables: hard &lt;lgl&gt;, bar &lt;lgl&gt;, pluribus &lt;lgl&gt;,
#   sugarpercent &lt;dbl&gt;, pricepercent &lt;dbl&gt;, winpercent &lt;dbl&gt;</code></pre>
</div>
</div>
</details>
<p><br> <br></p>
</section>
<section id="example-3-build-an-unpruned-tree" class="slide level2 unnumbered smaller">
<h2>EXAMPLE 3: Build an unpruned tree</h2>
<p><em>For demonstration purposes only</em> let’s:</p>
<ul>
<li>define a <code>popularity</code> variable that categorizes the candies as “low”, “medium”, or “high” popularity</li>
<li>delete the original <code>winpercent</code> variable</li>
<li>rename variables to make them easier to read in a tree</li>
<li>make the candy name a row label, not a predictor</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>candy <span class="ot">&lt;-</span> candy_rankings <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">popularity =</span> <span class="fu">cut</span>(winpercent, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">100</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"med"</span>, <span class="st">"high"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href=""></a>  <span class="fu">select</span>(<span class="sc">-</span>winpercent) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href=""></a>  <span class="fu">rename</span>(<span class="st">"price"</span> <span class="ot">=</span> pricepercent, <span class="st">"sugar"</span> <span class="ot">=</span> sugarpercent, <span class="st">"nutty"</span> <span class="ot">=</span> peanutyalmondy, <span class="st">"wafer"</span> <span class="ot">=</span> crispedricewafer) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href=""></a>  <span class="fu">column_to_rownames</span>(<span class="st">"competitorname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our goal is to model candy <code>popularity</code> by all possible predictors in our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="co"># STEP 1: tree specification</span></span>
<span id="cb14-2"><a href=""></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href=""></a>  <span class="fu">set_args</span>(<span class="at">cost_complexity =</span> <span class="dv">0</span>, <span class="at">min_n =</span> <span class="dv">2</span>, <span class="at">tree_depth =</span> <span class="dv">30</span>)</span>
<span id="cb14-6"><a href=""></a></span>
<span id="cb14-7"><a href=""></a><span class="co"># STEP 2: Build the tree! No tuning (hence no workflows) necessary.</span></span>
<span id="cb14-8"><a href=""></a>original_tree <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href=""></a>  <span class="fu">fit</span>(popularity <span class="sc">~</span> ., <span class="at">data =</span> candy)</span>
<span id="cb14-10"><a href=""></a></span>
<span id="cb14-11"><a href=""></a><span class="co"># Plot the tree</span></span>
<span id="cb14-12"><a href=""></a>original_tree <span class="sc">%&gt;%</span> </span>
<span id="cb14-13"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href=""></a>  <span class="fu">plot</span>(<span class="at">margin =</span> <span class="dv">0</span>) </span>
<span id="cb14-15"><a href=""></a>original_tree <span class="sc">%&gt;%</span> </span>
<span id="cb14-16"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-17"><a href=""></a>  <span class="fu">text</span>(<span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Ideally, our classification algorithm would have both low bias and low variance:</p>
<ul>
<li>low variance = the results wouldn’t change much if we changed up the data set</li>
<li>low bias = within any data set, the predictions of y tend to have low error / high accuracy</li>
</ul>
<p>Unfortunately, like other <strong>overfit</strong> algorithms, unpruned trees don’t enjoy both of these. They have…</p>
<ul>
<li>low bias, low variance</li>
<li>low bias, high variance</li>
<li>high bias, low variance</li>
<li>high bias, high variance</li>
</ul>
<details>
<summary>
Solution:
</summary>
low bias, high variance
</details>
<p><br> <br></p>
</section>
<section id="new-concept" class="slide level2 unnumbered smaller">
<h2>New Concept</h2>
<p><strong>GOAL</strong></p>
<p>Maintain the low bias of an unpruned tree while decreasing variance.</p>
<p><br>
</p>
<p><strong>APPROACH</strong></p>
<p>Build a bunch of unpruned trees from different data. This way, our final result isn’t overfit to our sample data.</p>
<p><br>
</p>
<p><strong>THE RUB (CHALLENGE/DIFFICULTY)</strong></p>
<p>We only have 1 set of data…</p>
<p><br></p>
</section>
<section id="example-4-take-a-resample-of-candy" class="slide level2 unnumbered smaller scrollable">
<h2>EXAMPLE 4: Take a REsample of candy</h2>
<p>We only have 1 sample of data. But we can <em>re</em>sample it (basically pretending we have a different sample).</p>
<p>Let’s each take our <em>own</em> unique candy resample (aka <strong>bootstrapping</strong>):</p>
<ul>
<li>Take a sample of 85 candies from the original 85 candies, <em>with</em> replacement.</li>
<li>Some data points will be sampled multiple times while others aren’t sampled at all.</li>
<li>On average, 2/3 of the original data points will show up in the resample and 1/3 will be left out.</li>
</ul>
<p>Take your resample:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a><span class="co"># Set the seed to YOUR phone number (just the numbers)</span></span>
<span id="cb15-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123456789</span>)</span>
<span id="cb15-3"><a href=""></a></span>
<span id="cb15-4"><a href=""></a><span class="co"># Take a REsample of candies from our sample</span></span>
<span id="cb15-5"><a href=""></a>my_candy <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(candy, <span class="at">size =</span> <span class="fu">nrow</span>(candy), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-6"><a href=""></a></span>
<span id="cb15-7"><a href=""></a><span class="co"># Check it out</span></span>
<span id="cb15-8"><a href=""></a><span class="fu">head</span>(my_candy, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     chocolate fruity caramel nutty nougat wafer  hard   bar
Snickers Crisper...1      TRUE  FALSE    TRUE  TRUE  FALSE  TRUE FALSE  TRUE
Fruit Chews...2          FALSE   TRUE   FALSE FALSE  FALSE FALSE FALSE FALSE
Nestle Crunch...3         TRUE  FALSE   FALSE FALSE  FALSE  TRUE FALSE  TRUE
                     pluribus sugar price popularity
Snickers Crisper...1    FALSE 0.604 0.651        med
Fruit Chews...2          TRUE 0.127 0.034        med
Nestle Crunch...3       FALSE 0.313 0.767       high</code></pre>
</div>
</div>
<p>In the next exercise, we’ll each build a tree of <code>popularity</code> using our own resample data.</p>
<p>First, check your intuition:</p>
<ol type="a">
<li>TRUE / FALSE: All of our trees will be the same.</li>
<li>TRUE / FALSE: Our trees will use the same <em>predictor</em> (but possibly a different cut-off) in the first split.</li>
<li>TRUE / FALSE: Our trees will use the same predictors in all splits.</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>FALSE</li>
<li>FALSE</li>
<li>FALSE</li>
</ol>
</details>
<p><br> <br></p>
<details>
<summary>
Fun Math Facts:
</summary>
<p>With resampling (also known as bootstrapping), we have an original sample of <span class="math inline">\(n\)</span> rows. We drawn individual rows with replacement from this set until we have another set of size <span class="math inline">\(n\)</span>.</p>
<p>The probability of choosing any one row (say the 1st row) on the first draw is <span class="math inline">\(1/n\)</span>. The probability of <strong>not</strong> choosing that one row is <span class="math inline">\(1-1/n\)</span>. That is just for the first draw. There are <span class="math inline">\(n\)</span> draws, all of which are independent, so the probability of never choosing this particular row on any of the draws is <span class="math inline">\((1-1/n)^n\)</span>.</p>
<p>If we consider larger and larger datasets (large <span class="math inline">\(n\)</span> going to infinity), then</p>
<p><span class="math display">\[\lim_{n \rightarrow \infty} (1-1/n)^n = 1/e \approx 0.368\]</span></p>
Thus, the probability that any one row is NOT chosen is about 1/3 and the probability that any one row is chosen is 2/3.
</details>
<p><br> <br></p>
</section>
<section id="example-5-build-share-your-tree" class="slide level2 unnumbered smaller">
<h2>EXAMPLE 5: Build &amp; share YOUR tree</h2>
<p>Build and plot a tree using your unique sample (<code>my_candy</code>):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="co"># Build your tree</span></span>
<span id="cb17-2"><a href=""></a>my_tree <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href=""></a>  <span class="fu">fit</span>(popularity <span class="sc">~</span> ., <span class="at">data =</span> my_candy)</span>
<span id="cb17-4"><a href=""></a></span>
<span id="cb17-5"><a href=""></a><span class="co"># Plot your tree</span></span>
<span id="cb17-6"><a href=""></a>my_tree <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-8"><a href=""></a>  <span class="fu">plot</span>(<span class="at">margin =</span> <span class="dv">0</span>) </span>
<span id="cb17-9"><a href=""></a>my_tree <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href=""></a>  <span class="fu">text</span>(<span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Use your tree to classify Baby Ruth, the 7th candy in the original data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>my_tree <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> candy[<span class="dv">7</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, share your results!</p>
<p>Record your prediction and paste a picture of your tree into <a href="https://docs.google.com/document/d/1S3l0dN1vPhy6N_OOom8Z91HPe4X9f-V-_EC0e9_L0do/edit?usp=sharing">this document</a>.</p>
<p><br></p>
</section>
<section id="example-6-using-our-forest" class="slide level2 unnumbered smaller scrollable">
<h2>EXAMPLE 6: Using our FOREST</h2>
<p>We now have a group of multiple trees – a <strong>forest</strong>!</p>
<p>These trees…</p>
<ul>
<li>differ from resample to resample</li>
<li>don’t use the same predictor in each split (not even in the first split)!</li>
<li>produce different <code>popularity</code> predictions for Baby Ruth</li>
</ul>
<ol type="a">
<li><p>Based on our <em>forest</em> of trees (not just your 1 tree), what’s your prediction for Baby Ruth’s popularity?</p></li>
<li><p>What do you think are the advantages of predicting candy popularity using a forest instead of a single tree?</p></li>
<li><p>Can you anticipate any <em>drawbacks</em> of using forests instead of trees?</p></li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>take the majority vote, i.e.&nbsp;most common category</li>
<li>by averaging across multiple trees, classifications will be more stable / less variable from dataset to dataset (lower variance)</li>
<li>computational intensity (lack of efficiency)</li>
</ol>
</details>
<p><br> <br></p>
</section></section>
<section>
<section id="notes-bagging-and-forests" class="title-slide slide level1 unnumbered center">
<h1>Notes: Bagging and Forests</h1>

</section>
<section id="bagging-bootstrap-aggregating-random-forests" class="slide level2 unnumbered smaller">
<h2>BAGGING (Bootstrap AGGregatING) &amp; Random Forests</h2>
<div>
<p>To classify a categorical response variable y using a set of p predictors x:</p>
<ul>
<li class="fragment"><p>Take B <em>re</em>samples from the original sample.</p>
<ul>
<li class="fragment">Sample WITH replacement</li>
<li class="fragment">Sample size = original sample size n</li>
</ul></li>
<li class="fragment"><p>Use each resample to build an <em>unpruned</em> tree.</p>
<ul>
<li class="fragment">For bagging: consider all p predictors in each split of each tree<br>
</li>
<li class="fragment">For <em>random</em> forests: at each split in each tree, randomly select and consider only a <em>subset</em> of the predictors (often roughly p/2 or <span class="math inline">\(\sqrt{p}\)</span>)</li>
</ul></li>
<li class="fragment"><p>Use each of the B trees to classify y at a set of predictor values x.</p></li>
<li class="fragment"><p>Average the classifications using a <em>majority vote</em>: classify y as the most common classification among the B trees.<br>
</p></li>
</ul>
</div>
<p><br></p>
</section>
<section id="ensemble-methods" class="slide level2 unnumbered smaller">
<h2>Ensemble Methods</h2>
<p>Bagging and random forest algorithms are <strong>ensemble methods</strong>.</p>
<p>They combine the outputs of <em>multiple</em> machine learning algorithms.</p>
<p>As a result, they decrease variability from sample to sample, hence provide more stable predictions / classifications than might be obtained by any algorithm alone.</p>
<p><br></p>
</section>
<section id="example-7-pros-cons" class="slide level2 unnumbered smaller scrollable">
<h2>EXAMPLE 7: pros &amp; cons</h2>
<ol type="a">
<li>Order trees, forests, &amp; bagging algorithms from least to most computationally expensive.</li>
<li>What results will be easier to interpret: trees or forests?</li>
<li>Which of bagging or forests will produce a collection of trees that tend to look very similar to each other, and similar to the original tree? Hence which of these algorithms is more dependent on the sample data, thus will <em>vary</em> more if we change up the data? [both questions have the same answer]</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>trees, forests, bagging</li>
<li>trees (we can’t draw a forest)</li>
<li>bagging (forests tend to have lower variability)</li>
</ol>
</details>
<p><br> <br></p>
</section></section>
<section>
<section id="exercises" class="title-slide slide level1 unnumbered center">
<h1>Exercises</h1>
<p>For the rest of the class, work together on Exercises 1–7</p>
</section>
<section id="section" class="slide level2 unnumbered smaller scrollable">
<h2></h2>
<ol type="1">
<li><strong>Tuning parameters (challenge)</strong></li>
</ol>
<p>Our random forest of <code>popularity</code> by all 11 possible predictors will depend upon 3 tuning parameters:</p>
<ul>
<li><code>trees</code> = the number of trees in the forest</li>
<li><code>mtry</code> = number of predictors to randomly choose &amp; consider at each split</li>
<li><code>min_n</code> = minimum number of data points in any leaf node of any tree</li>
</ul>
<p>Check your intuition.</p>
<ol type="a">
<li>Does increasing the number of <code>trees</code> make the forest algorithm <em>more</em> or <em>less</em> variable from dataset to dataset?</li>
<li>We have 11 possible predictors, and sqrt(11) is roughly 3. Recall: Would considering just 3 randomly chosen predictors in each split (instead of all 11) make the forest algorithm <em>more</em> or <em>less</em> variable from dataset to dataset?</li>
<li>Recall that using <em>unpruned</em> trees in our forest is important to maintaining low bias. Thus should <code>min_n</code> be small or big?</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>less variable (less impacted by “unlucky” trees)</li>
<li>less variable</li>
<li>small</li>
</ol>
</details>
<p><br><br></p>
<ol start="2" type="1">
<li><strong>Build the forest</strong><br>
Given that forests are relatively computationally expensive, we’ll only build <em>one</em> forest using the following tuning parameters:</li>
</ol>
<ul>
<li><code>mtry = NULL</code>: this sets <code>mtry</code> to the default, which is sqrt(number of predictors)</li>
<li><code>trees = 500</code></li>
<li><code>min_n = 2</code></li>
</ul>
<p>Fill in the below code to run this forest algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="co"># There's randomness behind the splits!</span></span>
<span id="cb19-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">253</span>)</span>
<span id="cb19-3"><a href=""></a>    </span>
<span id="cb19-4"><a href=""></a><span class="co"># STEP 1: Model Specification</span></span>
<span id="cb19-5"><a href=""></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"___"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href=""></a>  <span class="fu">___</span>(<span class="at">engine =</span> <span class="st">"ranger"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href=""></a>  <span class="fu">___</span>(</span>
<span id="cb19-9"><a href=""></a>    <span class="at">mtry =</span> <span class="cn">NULL</span>,</span>
<span id="cb19-10"><a href=""></a>    <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb19-11"><a href=""></a>    <span class="at">min_n =</span> <span class="dv">2</span>,</span>
<span id="cb19-12"><a href=""></a>    <span class="at">probability =</span> <span class="cn">FALSE</span>,    <span class="co"># Report classifications, not probability calculations</span></span>
<span id="cb19-13"><a href=""></a>    <span class="at">importance =</span> <span class="st">"impurity"</span> <span class="co"># Use Gini index to measure variable importance</span></span>
<span id="cb19-14"><a href=""></a>  )</span>
<span id="cb19-15"><a href=""></a>    </span>
<span id="cb19-16"><a href=""></a><span class="co"># STEP 2: Build the forest</span></span>
<span id="cb19-17"><a href=""></a><span class="co"># There are no preprocessing steps or tuning, hence no need for a workflow!</span></span>
<span id="cb19-18"><a href=""></a>candy_forest <span class="ot">&lt;-</span> ___ <span class="sc">%&gt;%</span> </span>
<span id="cb19-19"><a href=""></a>  <span class="fu">fit</span>(___, ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution:
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a><span class="co"># There's randomness behind the splits!</span></span>
<span id="cb20-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">253</span>)</span>
<span id="cb20-3"><a href=""></a>    </span>
<span id="cb20-4"><a href=""></a><span class="co"># STEP 1: Model Specification</span></span>
<span id="cb20-5"><a href=""></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"ranger"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href=""></a>  <span class="fu">set_args</span>(</span>
<span id="cb20-9"><a href=""></a>    <span class="at">mtry =</span> <span class="cn">NULL</span>,</span>
<span id="cb20-10"><a href=""></a>    <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb20-11"><a href=""></a>    <span class="at">min_n =</span> <span class="dv">2</span>,</span>
<span id="cb20-12"><a href=""></a>    <span class="at">probability =</span> <span class="cn">FALSE</span>, <span class="co"># give classifications, not probability calculations</span></span>
<span id="cb20-13"><a href=""></a>    <span class="at">importance =</span> <span class="st">"impurity"</span> <span class="co"># use Gini index to measure variable importance</span></span>
<span id="cb20-14"><a href=""></a>  )</span>
<span id="cb20-15"><a href=""></a>    </span>
<span id="cb20-16"><a href=""></a><span class="co"># STEP 2: Build the forest</span></span>
<span id="cb20-17"><a href=""></a><span class="co"># There are no preprocessing steps or tuning, hence no need for a workflow!</span></span>
<span id="cb20-18"><a href=""></a>candy_forest <span class="ot">&lt;-</span> rf_spec <span class="sc">%&gt;%</span> </span>
<span id="cb20-19"><a href=""></a>  <span class="fu">fit</span>(popularity <span class="sc">~</span> ., <span class="at">data =</span> candy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br><br></p>
<ol start="3" type="1">
<li><strong>Use the forest for prediction</strong><br>
Use the forest to predict the <code>popularity</code> level for Baby Ruth. (Remember that its real <code>popularity</code> is “med”.)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a>candy_forest <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> candy[<span class="dv">7</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  .pred_class
  &lt;fct&gt;      
1 med        </code></pre>
</div>
</div>
<p><br><br></p>
<ol start="4" type="1">
<li><strong>Evaluating forests: concepts</strong></li>
</ol>
<p>But how <em>good</em> is our forest at classifying candy popularity?</p>
<p>To this end, we could evaluate 3 types of forest predictions.</p>
<ol type="a">
<li>Why don’t <strong>in-sample</strong> predictions, i.e.&nbsp;asking how well our forest classifies our sample candies, give us an “honest” assessment of our forest’s performance?</li>
<li>Instead, suppose we used <strong>10-fold cross-validation (CV)</strong> to estimate how well our forest classifies <em>new</em> candies. In this process, how many total <em>trees</em> would we need to construct?<br>
</li>
<li>Alternatively, we can estimate how well our forest classifies <em>new</em> candies using the <strong>out-of-bag (OOB) error rate</strong>. Since we only use a <em>resample</em> of data points to build any given tree in the forest, the “out-of-bag” data points that do <em>not</em> appear in a tree’s resample are natural test cases for that tree. The OOB error rate tracks the proportion or percent of these out-of-bag test cases that are misclassified by their tree. How many total trees would we need to construct to calculate the OOB error rate?</li>
<li>Moving forward, we’ll use OOB and <em>not</em> CV to evaluate forest performance. Why?</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>they use the same data we used to build the forest</li>
<li>10 forests <code>*</code> 500 trees each = 5000 trees</li>
<li>1 forest <code>*</code> 500 trees = 500 trees</li>
<li>it’s much more computationally efficient</li>
</ol>
</details>
<p><br><br></p>
<ol start="5" type="1">
<li><strong>Evaluating forests: implementation</strong></li>
</ol>
<ol type="a">
<li>Report and interpret the estimated <code>OOB prediction error</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a>candy_forest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object

Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, num.trees = ~500,      min.node.size = min_rows(~2, x), probability = ~FALSE, importance = ~"impurity",      num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1)) 

Type:                             Classification 
Number of trees:                  500 
Sample size:                      85 
Number of independent variables:  11 
Mtry:                             3 
Target node size:                 2 
Variable importance mode:         impurity 
Splitrule:                        gini 
OOB prediction error:             40.00 % </code></pre>
</div>
</div>
<ol start="2" type="a">
<li>The <strong>test</strong> or <strong>OOB confusion matrix</strong> provides more detail. Use this to confirm the OOB prediction error from part a. HINT: Remember to calculate <em>error</em> (1 - accuracy), not <em>accuracy</em>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: t() transposes the confusion matrix so that </span></span>
<span id="cb25-2"><a href=""></a><span class="co"># the columns and rows are in the usual order</span></span>
<span id="cb25-3"><a href=""></a>candy_forest <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href=""></a>  <span class="fu">pluck</span>(<span class="st">"confusion.matrix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href=""></a>  <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         true
predicted low med high
     low    8   6    1
     med   15  29    6
     high   2   4   14</code></pre>
</div>
</div>
<ol start="3" type="a">
<li><p>Which level of candy popularity was least accurately classified by our forest?</p></li>
<li><p>Check out the <strong>in-sample</strong> confusion matrix. In general, are the in-sample predictions better or worse than the OOB predictions?</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a><span class="co"># The cbind() includes the original candy data</span></span>
<span id="cb27-2"><a href=""></a><span class="co"># alongside their predicted popularity levels</span></span>
<span id="cb27-3"><a href=""></a>candy_forest <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> candy) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href=""></a>  <span class="fu">cbind</span>(candy) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href=""></a>  <span class="fu">conf_mat</span>(</span>
<span id="cb27-7"><a href=""></a>    <span class="at">truth =</span> popularity,</span>
<span id="cb27-8"><a href=""></a>    <span class="at">estimate =</span> .pred_class</span>
<span id="cb27-9"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction low med high
      low   18   0    0
      med    6  39    2
      high   1   0   19</code></pre>
</div>
</div>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>We expect our forest to <em>mis</em>classify roughly 40% of <em>new</em> candies.</li>
<li>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a><span class="co"># APPROACH 1: # of MISclassifications / total # of classifications</span></span>
<span id="cb29-2"><a href=""></a>(<span class="dv">6</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span> <span class="sc">+</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">4</span>) <span class="sc">/</span> (<span class="dv">8</span> <span class="sc">+</span> <span class="dv">29</span> <span class="sc">+</span> <span class="dv">14</span> <span class="sc">+</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span> <span class="sc">+</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href=""></a><span class="co"># APPROACH 2: overall MISclassification rate = 1 - overall accuracy rate</span></span>
<span id="cb31-2"><a href=""></a><span class="co"># overall accuracy rate</span></span>
<span id="cb31-3"><a href=""></a>(<span class="dv">8</span> <span class="sc">+</span> <span class="dv">29</span> <span class="sc">+</span> <span class="dv">14</span>) <span class="sc">/</span> (<span class="dv">8</span> <span class="sc">+</span> <span class="dv">29</span> <span class="sc">+</span> <span class="dv">14</span> <span class="sc">+</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">15</span> <span class="sc">+</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href=""></a><span class="co"># overall misclassification rate</span></span>
<span id="cb33-2"><a href=""></a><span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>low (more were classified as “med” than as “low”)</li>
<li>much better!</li>
</ol>
</details>
<p><br><br></p>
<ol start="6" type="1">
<li><strong>Variable importance</strong></li>
</ol>
<p>Variable importance metrics, averaged over all trees, measure the strength of the 11 predictors in classifying candy <code>popularity</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a><span class="co"># Print the metrics</span></span>
<span id="cb35-2"><a href=""></a>candy_forest <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href=""></a>  <span class="fu">pluck</span>(<span class="st">"variable.importance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href=""></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    sugar     price chocolate    fruity     nutty     wafer  pluribus       bar 
9.4075750 9.0830343 5.0757837 2.8236876 2.2084982 2.1255274 1.8596475 1.8143452 
  caramel      hard    nougat 
1.6918086 1.3640697 0.9441936 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a><span class="co"># Plot the metrics</span></span>
<span id="cb37-2"><a href=""></a><span class="fu">library</span>(vip)</span>
<span id="cb37-3"><a href=""></a>candy_forest <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href=""></a>  <span class="fu">vip</span>(<span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">num_features =</span> <span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li>If you’re a candy connoisseur, does this ranking make some contextual sense to you?<br>
</li>
<li>The only 2 <em>quantitative</em> predictors, <code>sugar</code> and <code>price</code>, have the highest importance metrics. This <em>could</em> simply be due to their quantitative structure: trees tend to favor predictors with lots of unique values. <em>Explain</em>. HINT: A tree’s binary splits are identified by considering <em>every</em> possible cut / split point in <em>every</em> possible predictor.</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol type="a">
<li>will vary</li>
<li>predictors with lots of unique values have far more possible split points to choose from</li>
</ol>
</details>
<p><br><br></p>
<p><br></p>
<ol start="7" type="1">
<li><strong>Classification regions</strong></li>
</ol>
<p>Just like any classification model, forests divide our data points into classification regions.</p>
<p>Let’s explore this idea using some <em>simulated</em> data that illustrate some important contrasts.<sup>1</sup></p>
<p>Import and plot the data:</p>
<!-- note to self: change data source -->
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a><span class="co"># Import data</span></span>
<span id="cb38-2"><a href=""></a>simulated_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://kegrinde.github.io/stat253_coursenotes/data/circle_sim.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">as.factor</span>(class))</span>
<span id="cb38-4"><a href=""></a>    </span>
<span id="cb38-5"><a href=""></a><span class="co"># Plot data</span></span>
<span id="cb38-6"><a href=""></a><span class="fu">ggplot</span>(simulated_data, <span class="fu">aes</span>(<span class="at">y =</span> X2, <span class="at">x =</span> X1, <span class="at">color =</span> class)) <span class="sc">+</span> </span>
<span id="cb38-7"><a href=""></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb38-8"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="a">
<li>Below is a classification <strong>tree</strong> of <code>class</code> by <code>X1</code> and <code>X2</code>. What do you think its classification regions will look like?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a><span class="co"># Build the (default) tree</span></span>
<span id="cb39-2"><a href=""></a>circle_tree <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href=""></a>  <span class="fu">fit</span>(class <span class="sc">~</span> ., <span class="at">data =</span> simulated_data)</span>
<span id="cb39-6"><a href=""></a></span>
<span id="cb39-7"><a href=""></a>circle_tree <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href=""></a>  <span class="fu">rpart.plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="a">
<li>Check your intuition. Were you right?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a><span class="co"># THIS IS ONLY DEMO CODE.</span></span>
<span id="cb40-2"><a href=""></a><span class="co"># Plot the tree classification regions</span></span>
<span id="cb40-3"><a href=""></a>examples <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">len =</span> <span class="dv">100</span>), <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">len =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href=""></a>  <span class="fu">expand.grid</span>()</span>
<span id="cb40-5"><a href=""></a></span>
<span id="cb40-6"><a href=""></a>circle_tree <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> examples) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href=""></a>  <span class="fu">cbind</span>(examples) <span class="sc">%&gt;%</span> </span>
<span id="cb40-9"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> X2, <span class="at">x =</span> X1, <span class="at">color =</span> .pred_class)) <span class="sc">+</span> </span>
<span id="cb40-10"><a href=""></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb40-11"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"tree classification regions"</span>) <span class="sc">+</span> </span>
<span id="cb40-12"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="a">
<li><p>If we built a <strong>forest</strong> model of <code>class</code> by <code>X1</code> and <code>X2</code>, what do you think the classification regions will look like?</p></li>
<li><p>Check your intuition. Were you right?</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a><span class="co"># THIS IS ONLY DEMO CODE.</span></span>
<span id="cb41-2"><a href=""></a><span class="co"># Build the forest</span></span>
<span id="cb41-3"><a href=""></a>circle_forest <span class="ot">&lt;-</span> rf_spec <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href=""></a>  <span class="fu">fit</span>(class <span class="sc">~</span> ., <span class="at">data =</span> simulated_data)</span>
<span id="cb41-5"><a href=""></a></span>
<span id="cb41-6"><a href=""></a><span class="co"># Plot the tree classification regions</span></span>
<span id="cb41-7"><a href=""></a>circle_forest <span class="sc">%&gt;%</span> </span>
<span id="cb41-8"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> examples) <span class="sc">%&gt;%</span> </span>
<span id="cb41-9"><a href=""></a>  <span class="fu">cbind</span>(examples) <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> X2, <span class="at">x =</span> X1, <span class="at">color =</span> .pred_class)) <span class="sc">+</span> </span>
<span id="cb41-11"><a href=""></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb41-12"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"forest classification regions"</span>) <span class="sc">+</span> </span>
<span id="cb41-13"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="a">
<li>Reflect on what you’ve observed here!</li>
</ol>
<details>
<summary>
Solution:
</summary>
<ol start="2" type="a">
<li>…</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href=""></a><span class="co"># THIS IS ONLY DEMO CODE.</span></span>
<span id="cb42-2"><a href=""></a><span class="co"># Plot the tree classification regions</span></span>
<span id="cb42-3"><a href=""></a>examples <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">len =</span> <span class="dv">100</span>), <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">len =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href=""></a>  <span class="fu">expand.grid</span>()</span>
<span id="cb42-5"><a href=""></a></span>
<span id="cb42-6"><a href=""></a>circle_tree <span class="sc">%&gt;%</span> </span>
<span id="cb42-7"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> examples) <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href=""></a>  <span class="fu">cbind</span>(examples) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> X2, <span class="at">x =</span> X1, <span class="at">color =</span> .pred_class)) <span class="sc">+</span> </span>
<span id="cb42-10"><a href=""></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb42-11"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"tree classification regions"</span>) <span class="sc">+</span> </span>
<span id="cb42-12"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="a">
<li>…</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href=""></a><span class="co"># THIS IS ONLY DEMO CODE.</span></span>
<span id="cb43-2"><a href=""></a><span class="co"># Build the forest</span></span>
<span id="cb43-3"><a href=""></a>circle_forest <span class="ot">&lt;-</span> rf_spec <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href=""></a>  <span class="fu">fit</span>(class <span class="sc">~</span> ., <span class="at">data =</span> simulated_data)</span>
<span id="cb43-5"><a href=""></a></span>
<span id="cb43-6"><a href=""></a><span class="co"># Plot the tree classification regions</span></span>
<span id="cb43-7"><a href=""></a>circle_forest <span class="sc">%&gt;%</span> </span>
<span id="cb43-8"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> examples) <span class="sc">%&gt;%</span> </span>
<span id="cb43-9"><a href=""></a>  <span class="fu">cbind</span>(examples) <span class="sc">%&gt;%</span> </span>
<span id="cb43-10"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> X2, <span class="at">x =</span> X1, <span class="at">color =</span> .pred_class)) <span class="sc">+</span> </span>
<span id="cb43-11"><a href=""></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb43-12"><a href=""></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"forest classification regions"</span>) <span class="sc">+</span> </span>
<span id="cb43-13"><a href=""></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="L15-forests_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="a">
<li>Forest classification regions are less rigid / boxy than tree classification regions.</li>
</ol>
</details>
<p><br></p>
<p><br></p>
<p><strong>If you finish early</strong></p>
<p>Do one of the following:</p>
<ul>
<li>Check out the optional “Deeper learning” section below on another ensemble method: <strong>boosting</strong>.</li>
<li>Check out group assignment 2 on Moodle. Next class, your group will pick what topic to explore.</li>
<li>Work on homework.</li>
</ul>
<p><br><br></p>
<aside><ol class="aside-footnotes"><li id="fn1"><p>citation: https://daviddalpiaz.github.io/r4sl/ensemble-methods.html#tree-versus-ensemble-boundaries</p></li></ol></aside></section></section>
<section id="wrapping-up" class="title-slide slide level1 unnumbered smaller center">
<h1>Wrapping Up</h1>
<ul>
<li>As usual, take time after class to finish any remaining exercises, check solutions, reflect on key concepts from today, and come to office hours with questions</li>
<li>Upcoming due dates:
<ul>
<li>Before next class: CP11 (formal review of forests) <em><strong>AND</strong></em> review Group Assignment 2 instructions</li>
<li>Next Wednesday: HW5 and HW4 Revisions</li>
<li>Coming soon: Quiz 2 (Nov 19), Group Assignment 2 (Nov 26)</li>
</ul></li>
</ul>
<p><br><br></p>
</section>

<section id="deeper-learning-optional" class="title-slide slide level1 unnumbered center">
<h1>Deeper learning (optional)</h1>
<p><em>Extreme gradient boosting</em>, or <strong>XGBoost</strong>, is yet another ensemble algorithm for regression and classification. We’ll consider the big picture here. If you want to dig deeper:</p>
<ul>
<li>Section 8.2.3 of the book provides a more detailed background</li>
<li>Julia Silge’s <a href="https://juliasilge.com/blog/baseball-racing/">blogpost on predicting home runs</a> provides an example of implementing XGBoost using <code>tidymodels</code>.</li>
</ul>
<p>The <strong>big picture</strong>:</p>
<ul>
<li><p>Like bagging and forests, boosting combines predictions from B different trees.</p></li>
<li><p>BUT these trees aren’t built from B different resamples. Boosting trees are grown <em>sequentially</em>, each tree <em>slowly learning</em> from the previous trees in the sequence to <em>improve</em> in areas where the previous trees didn’t do well. Loosely speaking, data points with larger misclassification rates among previous trees are given more weight in building future trees.</p></li>
<li><p>Unlike in bagging and forests, trees with better performance are given more weight in making future classifications.</p></li>
</ul>
<p><br>
<br>
</p>
<p><strong>Bagging vs boosting</strong></p>
<ul>
<li><p>Bagging typically helps decrease variance, but not bias. Thus it is useful in scenarios where other algorithms are unstable and overfit to the sample data.</p></li>
<li><p>Boosting typically helps decrease bias, but not variance. Thus it is useful in scenarios where other algorithms are stable, but overly simple.</p></li>
</ul>
<p><br><br></p>
</section>

<section id="notes-r-code" class="title-slide slide level1 unnumbered center">
<h1>Notes: R code</h1>
<p>Suppose we want to build a forest or bagging algorithm of some categorical response variable <code>y</code> using predictors <code>x1</code> and <code>x2</code> in our <code>sample_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href=""></a><span class="co"># Load packages</span></span>
<span id="cb44-2"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb44-3"><a href=""></a><span class="fu">library</span>(rpart)</span>
<span id="cb44-4"><a href=""></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb44-5"><a href=""></a></span>
<span id="cb44-6"><a href=""></a><span class="co"># Resolves package conflicts by preferring tidymodels functions</span></span>
<span id="cb44-7"><a href=""></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Make sure that y is a factor variable</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href=""></a>sample_data <span class="ot">&lt;-</span> sample_data <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">as.factor</span>(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Build the forest / bagging model</strong></p>
<p>We’ll typically use the following tuning parameters:</p>
<ul>
<li><code>trees</code> = 500 (the more trees we use, the less variable the forest)</li>
<li><code>min_n</code> = 2 (the smaller we allow the leaf nodes to be, the less pruned, hence less biased our forest will be)</li>
<li><code>mtry</code>
<ul>
<li>for forests: <code>mtry = NULL</code> (the default) will use the “floor”, or biggest integer below, sqrt(number of predictors)</li>
<li>for bagging: set <code>mtry</code> to the number of predictors</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href=""></a><span class="co"># STEP 1: Model Specification</span></span>
<span id="cb46-2"><a href=""></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href=""></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"ranger"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href=""></a>  <span class="fu">set_args</span>(</span>
<span id="cb46-6"><a href=""></a>    <span class="at">mtry =</span> ___,</span>
<span id="cb46-7"><a href=""></a>    <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb46-8"><a href=""></a>    <span class="at">min_n =</span> <span class="dv">2</span>,</span>
<span id="cb46-9"><a href=""></a>    <span class="at">probability =</span> <span class="cn">FALSE</span>, <span class="co"># give classifications, not probability calculations</span></span>
<span id="cb46-10"><a href=""></a>    <span class="at">importance =</span> <span class="st">"impurity"</span> <span class="co"># use Gini index to measure variable importance</span></span>
<span id="cb46-11"><a href=""></a>  )</span>
<span id="cb46-12"><a href=""></a></span>
<span id="cb46-13"><a href=""></a><span class="co"># STEP 2: Build the forest or bagging model</span></span>
<span id="cb46-14"><a href=""></a><span class="co"># There are no preprocessing steps or tuning, hence no need for a workflow!</span></span>
<span id="cb46-15"><a href=""></a>ensemble_model <span class="ot">&lt;-</span> rf_spec <span class="sc">%&gt;%</span> </span>
<span id="cb46-16"><a href=""></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Use the model to make predictions / classifications</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href=""></a><span class="co"># Put in a data.frame object with x1 and x2 values (at minimum)</span></span>
<span id="cb47-2"><a href=""></a>ensemble_model <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> ___)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Examine variable importance</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href=""></a><span class="co"># Print the metrics</span></span>
<span id="cb48-2"><a href=""></a>ensemble_model <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href=""></a>  <span class="fu">pluck</span>(<span class="st">"variable.importance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-5"><a href=""></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-6"><a href=""></a></span>
<span id="cb48-7"><a href=""></a><span class="co"># Plot the metrics</span></span>
<span id="cb48-8"><a href=""></a><span class="co"># Plug in the number of top predictors you wish to plot</span></span>
<span id="cb48-9"><a href=""></a><span class="co"># (The upper limit varies by application!)</span></span>
<span id="cb48-10"><a href=""></a><span class="fu">library</span>(vip)</span>
<span id="cb48-11"><a href=""></a>ensemble_model <span class="sc">%&gt;%</span> </span>
<span id="cb48-12"><a href=""></a>  <span class="fu">vip</span>(<span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">num_features =</span> ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
</p>
<p><strong>Evaluate the classifications</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href=""></a><span class="co"># Out-of-bag (OOB) prediction error</span></span>
<span id="cb49-2"><a href=""></a>ensemble_model</span>
<span id="cb49-3"><a href=""></a></span>
<span id="cb49-4"><a href=""></a><span class="co"># OOB confusion matrix</span></span>
<span id="cb49-5"><a href=""></a>ensemble_model <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href=""></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href=""></a>  <span class="fu">pluck</span>(<span class="st">"confusion.matrix"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href=""></a>  <span class="fu">t</span>()</span>
<span id="cb49-9"><a href=""></a></span>
<span id="cb49-10"><a href=""></a><span class="co"># In-sample confusion matrix</span></span>
<span id="cb49-11"><a href=""></a>ensemble_model <span class="sc">%&gt;%</span> </span>
<span id="cb49-12"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> sample_data) <span class="sc">%&gt;%</span> </span>
<span id="cb49-13"><a href=""></a>  <span class="fu">cbind</span>(sample_data) <span class="sc">%&gt;%</span> </span>
<span id="cb49-14"><a href=""></a>  <span class="fu">conf_mat</span>(</span>
<span id="cb49-15"><a href=""></a>    <span class="at">truth =</span> y,</span>
<span id="cb49-16"><a href=""></a>    <span class="at">estimate =</span> .pred_class</span>
<span id="cb49-17"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-auto-generated-content">
<p><img src="images/mac.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://kegrinde.github.io/stat253_coursenotes" class="uri">https://kegrinde.github.io/stat253_coursenotes</a></p>
</div>
</div>
</section>


    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="L15-forests_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="L15-forests_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="L15-forests_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="L15-forests_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":"17298895849303670038","id":"611bfc41e194285d","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>